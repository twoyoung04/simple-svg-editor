(()=>{"use strict";var t={424:(t,e,n)=>{n.d(e,{Z:()=>a});var r=n(537),i=n.n(r),o=n(645),s=n.n(o)()(i());s.push([t.id,"html,\nbody {\n  margin: 0;\n  padding: 0;\n}\n\n.cursor-crosshair {\n  cursor: crosshair;\n}\n.cursor-pointer {\n  cursor: pointer;\n}\n.cursor-default {\n  cursor: default;\n}\n.cursor-grab {\n  cursor: grab;\n}\n.cursor-resize {\n  cursor: nwse-resize;\n}\n.cursor-move {\n  cursor: move;\n}\n","",{version:3,sources:["webpack://./src/index.css"],names:[],mappings:"AAAA;;EAEE,SAAS;EACT,UAAU;AACZ;;AAEA;EACE,iBAAiB;AACnB;AACA;EACE,eAAe;AACjB;AACA;EACE,eAAe;AACjB;AACA;EACE,YAAY;AACd;AACA;EACE,mBAAmB;AACrB;AACA;EACE,YAAY;AACd",sourcesContent:["html,\nbody {\n  margin: 0;\n  padding: 0;\n}\n\n.cursor-crosshair {\n  cursor: crosshair;\n}\n.cursor-pointer {\n  cursor: pointer;\n}\n.cursor-default {\n  cursor: default;\n}\n.cursor-grab {\n  cursor: grab;\n}\n.cursor-resize {\n  cursor: nwse-resize;\n}\n.cursor-move {\n  cursor: move;\n}\n"],sourceRoot:""}]);const a=s},645:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n="",r=void 0!==e[5];return e[4]&&(n+="@supports (".concat(e[4],") {")),e[2]&&(n+="@media ".concat(e[2]," {")),r&&(n+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),n+=t(e),r&&(n+="}"),e[2]&&(n+="}"),e[4]&&(n+="}"),n})).join("")},e.i=function(t,n,r,i,o){"string"==typeof t&&(t=[[null,t,void 0]]);var s={};if(r)for(var a=0;a<this.length;a++){var c=this[a][0];null!=c&&(s[c]=!0)}for(var h=0;h<t.length;h++){var u=[].concat(t[h]);r&&s[u[0]]||(void 0!==o&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=o),n&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=n):u[2]=n),i&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=i):u[4]="".concat(i)),e.push(u))}},e}},537:t=>{t.exports=function(t){var e=t[1],n=t[3];if(!n)return e;if("function"==typeof btoa){var r=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),i="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(r),o="/*# ".concat(i," */"),s=n.sources.map((function(t){return"/*# sourceURL=".concat(n.sourceRoot||"").concat(t," */")}));return[e].concat(s).concat([o]).join("\n")}return[e].join("\n")}},379:t=>{var e=[];function n(t){for(var n=-1,r=0;r<e.length;r++)if(e[r].identifier===t){n=r;break}return n}function r(t,r){for(var o={},s=[],a=0;a<t.length;a++){var c=t[a],h=r.base?c[0]+r.base:c[0],u=o[h]||0,d="".concat(h," ").concat(u);o[h]=u+1;var f=n(d),l={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==f)e[f].references++,e[f].updater(l);else{var p=i(l,r);r.byIndex=a,e.splice(a,0,{identifier:d,updater:p,references:1})}s.push(d)}return s}function i(t,e){var n=e.domAPI(e);return n.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;n.update(t=e)}else n.remove()}}t.exports=function(t,i){var o=r(t=t||[],i=i||{});return function(t){t=t||[];for(var s=0;s<o.length;s++){var a=n(o[s]);e[a].references--}for(var c=r(t,i),h=0;h<o.length;h++){var u=n(o[h]);0===e[u].references&&(e[u].updater(),e.splice(u,1))}o=c}}},569:t=>{var e={};t.exports=function(t,n){var r=function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}(t);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(n)}},216:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},565:(t,e,n)=>{t.exports=function(t){var e=n.nc;e&&t.setAttribute("nonce",e)}},795:t=>{t.exports=function(t){var e=t.insertStyleElement(t);return{update:function(n){!function(t,e,n){var r="";n.supports&&(r+="@supports (".concat(n.supports,") {")),n.media&&(r+="@media ".concat(n.media," {"));var i=void 0!==n.layer;i&&(r+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),r+=n.css,i&&(r+="}"),n.media&&(r+="}"),n.supports&&(r+="}");var o=n.sourceMap;o&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),e.styleTagTransform(r,t,e.options)}(e,t,n)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},589:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}}},e={};function n(r){var i=e[r];if(void 0!==i)return i.exports;var o=e[r]={id:r,exports:{}};return t[r](o,o.exports,n),o.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.nc=void 0,(()=>{var t,e,r,i,o,s,a=function(){function t(t,e){this._x=t,this._y=e}return Object.defineProperty(t.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mod",{get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},enumerable:!1,configurable:!0}),t.ones=function(){return new t(1,1)},t.zeros=function(){return new t(0,0)},t.prototype.add=function(t){return this._x+=t.x,this._y+=t.y,this},t.prototype.subtract=function(t){return this._x-=t.x,this._y-=t.y,this},t.prototype.dotMultiply=function(t){return this._x*=t.x,this._y*=t.y,this},t.prototype.crossMultiply=function(t){return this._x*t.y-this._y*t.x},t.prototype.angle=function(t){return Math.acos(Math.min((this._x*t.x+this._y*t.y)/this.mod/t.mod,1))},t.prototype.distance=function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))},t.prototype.rotateAtOrigin=function(t){var e=[this.x*Math.cos(t)-this.y*Math.sin(t),this.x*Math.sin(t)+this.y*Math.cos(t)],n=e[0],r=e[1];return this.x=n,this.y=r,this},t.prototype.applyTransform=function(t){var e=t.a,n=t.b,r=t.c,i=t.d,o=t.e,s=t.f,a=[e*this.x+r*this.y+o,n*this.x+i*this.y+s],c=a[0],h=a[1];return this.x=c,this.y=h,this},t.prototype.opposite=function(){return new t(-this._x,-this._y)},t.prototype.clone=function(){return new t(this.x,this.y)},t}(),c=function(){function t(t,e,n,r){this.x=t,this.y=e,this.w=n,this.h=r}return Object.defineProperty(t.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"w",{get:function(){return this._w},set:function(t){this._w=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"h",{get:function(){return this._h},set:function(t){this._h=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"x2",{get:function(){return this._x+this._w},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y2",{get:function(){return this._y+this._h},enumerable:!1,configurable:!0}),t.prototype.set=function(t){this.x=t.x,this.y=t.y,this.w=t.w,this.h=t.h},t.prototype.set4=function(t,e,n,r){this.x=t,this.y=e,this.w=n,this.h=r},t.prototype.setSize=function(t,e){this.w=t,this.h=e},t.prototype.merge=function(t){},t.mergeAll=function(e){if(0==e.length)return null;if(1==e.length)return e[0];var n=Math.min.apply(Math,e.map((function(t){return t.x}))),r=Math.max.apply(Math,e.map((function(t){return t.x+t.w}))),i=Math.min.apply(Math,e.map((function(t){return t.y})));return new t(n,i,r-n,Math.max.apply(Math,e.map((function(t){return t.y+t.h})))-i)},t.prototype.center=function(){return new a(this.x+this.w/2,this.y+this.h/2)},t}(),h=function(){function t(){}return t.Error=function(t){console.error(t)},t.blue=function(t){console.info("%c "+t,"color:blue;")},t.red=function(t){console.info("%c "+t,"color:red;")},t}(),u=function(){function t(t,e,n,r,i,o){this.a=t,this.b=e,this.c=n,this.d=r,this.e=i,this.f=o}return t.identity=function(){return new t(1,0,0,1,0,0)},t.from=function(e){return new t(e.a,e.b,e.c,e.d,e.e,e.f)},t.prototype.set=function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.e=t.e,this.f=t.f},t.prototype.setFromArray=function(t){this.a=t[0],this.b=t[1],this.c=t[2],this.d=t[3],this.e=t[4],this.f=t[5]},t.prototype.copy=function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.e=t.e,this.f=t.f,this},t.prototype.clone=function(){return t.from(this)},t.prototype.reset=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this},t.prototype.translate=function(t){return this.translate2(t.x,t.y)},t.prototype.translate2=function(t,e){return this.e+=t,this.f+=e,this},t.prototype.rotateAtOrigin=function(e){var n=[Math.sin(e),Math.cos(e)],r=n[0],i=n[1];return this.rightMultiply(new t(i,r,-r,i,0,0))},t.prototype.rotate=function(t,e){return this.translate(a.zeros().subtract(e)).rotateAtOrigin(t).translate(e)},t.prototype.scale=function(e,n,r){return this.copy(t.identity().translate(r.opposite()).scaleAtOrigin(e,n).translate(r).rightMultiply(this))},t.prototype.scaleAtOrigin=function(t,e){return this.a*=t,this.e*=t,this.d*=e,this.f*=e,this},t.prototype.flipY=function(){var e=this,n=e.a,r=e.b,i=e.c,o=e.d,s=e.e,a=e.f,c=[.5,.5],h=c[0],u=c[1],d=[n*h+i*u+s,r*h+o*u+a][0];return this.rightMultiply(new t(-1,0,0,1,0,0)).translate2(2*d,0),this},t.prototype.rightMultiply=function(t){var e=t.a*this.a+t.c*this.b,n=t.b*this.a+t.d*this.b,r=t.a*this.c+t.c*this.d,i=t.b*this.c+t.d*this.d,o=t.a*this.e+t.c*this.f+t.e,s=t.b*this.e+t.d*this.f+t.f;return this.a=e,this.b=n,this.c=r,this.d=i,this.e=o,this.f=s,this},t.prototype.leftMultiply=function(t){},t.prototype.inverse=function(){var e=this,n=e.a,r=e.b,i=e.c,o=e.d,s=e.e,a=e.f,c=n*o-r*i;return new t(o/c,-r/c,-i/c,n/c,(i*a-o*s)/c,(r*s-n*a)/c)},t.prototype.cssString=function(){return"matrix(".concat(this.a,",").concat(this.b,",").concat(this.c,",").concat(this.d,",").concat(this.e,",").concat(this.f,")")},t}(),d=function(){function t(t,e){this.box=t,this.transform=e}return Object.defineProperty(t.prototype,"box",{get:function(){return this._box},set:function(t){this._box=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transform",{get:function(){return this._transform},set:function(t){this._transform=t},enumerable:!1,configurable:!0}),t.prototype.include=function(t){var e=t.clone().applyTransform(this._transform.inverse());return e.x<this.box.x2&&e.x>this.box.x&&e.y<this.box.y2&&e.y>this.box.y},t.prototype.nearestCornerDistance=function(t){var e=t.clone().applyTransform(this._transform.inverse());return[new a(this.box.x,this.box.y),new a(this.box.x,this.box.y2),new a(this.box.x2,this.box.y2),new a(this.box.x2,this.box.y)].map((function(t){return t.distance(e)}))},t.prototype.center=function(){return this.box.center().clone().applyTransform(this.transform)},t}(),f=function(){function t(t,e,n,r){this.frameWidth=n,this.frameHeight=r,this.transform=u.identity(),this.transform.reset().translate2(t,e),this.board=window.board,this.AABB=new c(t,e,n,r),this.area=new d(this.AABB,this.transform),this.zIndex=0,this.board.eventEmitter.on("createSart",this.onCreateStart.bind(this)),this.board.eventEmitter.on("creating",this.onCreating.bind(this)),this.board.eventEmitter.on("createEnd",this.onCreateEnd.bind(this))}return Object.defineProperty(t.prototype,"area",{get:function(){return this._area},set:function(t){this._area=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"domInstance",{get:function(){return this._domInstance||this.createDomInstance(),this._domInstance},set:function(t){this._domInstance=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"frameWidth",{get:function(){return this._frameWidth},set:function(t){this._frameWidth=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"frameHeight",{get:function(){return this._frameHeight},set:function(t){this._frameHeight=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transform",{get:function(){return this._transform},set:function(t){this._transform=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"AABB",{get:function(){return this._AABB},set:function(t){this._AABB=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"zIndex",{get:function(){return this._zIndex},set:function(t){this._zIndex=t},enumerable:!1,configurable:!0}),t.prototype.onCreateStart=function(){},t.prototype.onCreating=function(){h.blue("on creating in baseelement")},t.prototype.onCreateEnd=function(){},t.prototype.setFrameWidth=function(t){this.frameWidth=t},t.prototype.setFrameHeight=function(t){this.frameHeight=t},t}(),l="#d9d9d9",p="http://www.w3.org/2000/svg",m=function(t,e){var n=t.createElementNS(p,"svg");if(e)return Object.keys(e).forEach((function(t){n.setAttribute(t,e[t])})),n},y=function(t,e){Object.keys(e).forEach((function(n){t.setAttribute(n,e[n])}))},g=(t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)},function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}),v=function(t){function e(e,n,r,i){var o=t.call(this,e,n,r,i)||this;return o.attr={cx:o.frameWidth/2,cy:o.frameHeight/2,rx:o.frameWidth/2,ry:o.frameHeight/2},o}return g(e,t),e.prototype.createDomInstance=function(){var t=document.createElementNS(p,"ellipse");y(t,this.attr),y(t,{fill:l}),this._domInstance=t},e.prototype.updateAttr=function(){this.attr={cx:this.frameWidth/2,cy:this.frameHeight/2,rx:this.frameWidth/2,ry:this.frameHeight/2}},e.prototype.updateRendering=function(){this.updateAttr(),y(this._domInstance,this.attr);var t=this._transform,e=t.a,n=t.b,r=t.c,i=t.d,o=t.e,s=t.f;y(this._domInstance,{transform:"matrix(".concat(e,",").concat(n,",").concat(r,",").concat(i,",").concat(o,",").concat(s,")")})},e.prototype.onCreateStart=function(){},e.prototype.onCreating=function(){},e.prototype.onCreateEnd=function(){},e}(f),b=function(){function t(){this.callbacks={}}return t.prototype.on=function(t,e){return void 0===t||""===t?(console.warn("wrong names"),!1):void 0===e?(console.warn("wrong callback"),!1):((this.callbacks[t]||(this.callbacks[t]=[])).push(e),this)},t.prototype.off=function(t){return void 0===t||""===t?(console.warn("wrong name"),!1):(this.callbacks[t]instanceof Array&&delete this.callbacks[t],this)},t.prototype.trigger=function(t,e){var n=this;if(void 0===t||""===t)return console.warn("wrong name"),!1;var r=e instanceof Array?e:[];this.callbacks[t]&&this.callbacks[t].forEach((function(t){t.apply(n,r)}))},t}(),E=function(){function t(t,e){this.name=t,this.mouseEvent=e}return Object.defineProperty(t.prototype,"name",{get:function(){return this._name},set:function(t){this._name=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mouseEvent",{get:function(){return this._mouseEvent},set:function(t){this._mouseEvent=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"customData",{get:function(){return this._customData},set:function(t){this._customData=t},enumerable:!1,configurable:!0}),t}(),A=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),_=function(t){function e(e,n,r,i){var o=t.call(this,e,n,r,i)||this;return o.attr={x:0,y:0,width:r,height:i},o}return A(e,t),e.prototype.createDomInstance=function(){var t=document.createElementNS(p,"rect");y(t,this.attr),y(t,{fill:l}),this._domInstance=t},e.prototype.updateAttr=function(){this.attr.width=this.frameWidth,this.attr.height=this.frameHeight},e.prototype.updateAABB=function(){this.AABB.setSize(this.frameWidth,this.frameHeight)},e.prototype.updateRendering=function(){this.updateAttr(),y(this._domInstance,this.attr);var t=this._transform,e=t.a,n=t.b,r=t.c,i=t.d,o=t.e,s=t.f;y(this._domInstance,{transform:"matrix(".concat(e,",").concat(n,",").concat(r,",").concat(i,",").concat(o,",").concat(s,")")})},e.prototype.onCreating=function(){this.updateAABB()},e}(f),S=function(){return S=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},S.apply(this,arguments)},w=function(){function t(t){this.board=t,this.container=t.svgroot,this.selectorRoot=t.svgdoc.createElementNS(p,"g"),this.selectRect=t.svgdoc.createElementNS(p,"rect"),this.selectedRect=t.svgdoc.createElementNS(p,"rect"),y(this.selectRect,{fill:"#f00",stroke:"#66c","stroke-width":"0.5","fill-opacity":"0.15",display:"none"}),y(this.selectedRect,{fill:"none",stroke:"#009aff","stroke-width":"2.5","fill-opacity":"0.15",display:"none"}),this.selectorRoot.append(this.selectRect),this.selectorRoot.append(this.selectedRect),this.container.append(this.selectorRoot),t.eventEmitter.on("selectStart",this.onSelectStart.bind(this)),t.eventEmitter.on("selectMove",this.onSelectMove.bind(this)),t.eventEmitter.on("selectEnd",this.onSelectEnd.bind(this)),t.eventEmitter.on("elementSelected",this.onElemetSelected.bind(this)),t.eventEmitter.on("nothingSelected",this.onNothingSelected.bind(this)),t.eventEmitter.on("draging",this.onDraging.bind(this)),t.eventEmitter.on("rotating",this.onRotating.bind(this)),t.eventEmitter.on("scaling",this.onScaling.bind(this))}return t.prototype.onSelectStart=function(t){},t.prototype.onSelectMove=function(t){y(this.selectRect,{display:"inline",x:Math.min(t.customData.startX,t.customData.endX),y:Math.min(t.customData.startY,t.customData.endY),width:Math.abs(t.customData.endX-t.customData.startX),height:Math.abs(t.customData.endY-t.customData.startY)})},t.prototype.onSelectEnd=function(t){this.selectRect.setAttribute("display","none"),this.selectRect.setAttribute("width","0"),this.selectRect.setAttribute("height","0")},t.prototype.onElemetSelected=function(t){var e=this.board.selection;if(t.customData.area,e&&1===e.length){var n=e[0],r=n.transform,i=n.frameWidth,o=n.frameHeight;this.selectorTransform=r.clone();var s={x:0,y:0,width:i,height:o};y(this.selectedRect,S({transform:r.cssString(),display:"inline"},s))}},t.prototype.onNothingSelected=function(t){y(this.selectedRect,{display:"none"})},t.prototype.onDragStart=function(t){},t.prototype.onDraging=function(t){this.onElemetSelected(t)},t.prototype.onRotating=function(t){this.updateRender()},t.prototype.onScaling=function(t){this.updateRender()},t.prototype.onElementCreateing=function(t){var e=this.board.selection;if(e&&1===e.length){var n=e[0],r=n.transform,i={x:0,y:0,width:n.frameWidth,height:n.frameHeight};y(this.selectedRect,S({transform:r.cssString(),display:"inline"},i))}},t.prototype.updateSelector=function(){},t.prototype.updateRender=function(){var t=this.board.selection;if(t&&1===t.length){var e=t[0],n=e.transform;e.frameWidth,e.frameHeight,y(this.selectedRect,{transform:n.cssString(),display:"inline"})}},t}(),x=function(){return x=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},x.apply(this,arguments)},M=function(){function t(t){var n=this;this.boardX=0,this.boardY=0,this.MouseDown=!1,this.mouseStartX=0,this.mouseStartY=0,this.lastZIndex=0,this._mouseStatus=o.DRAG,this.saveOptions={},this.selection=[],this.selectionArea=new d(new c(0,0,0,0),u.identity()),this.plugins=[],this.currentMode=e.SELECT,this.currentResizeMode=i.CASUAL,this.rubberBox=null,this.curBBoxes=[],this.curConfig={dimensions:[800,600]},this.elements=[],this.selectionTransforms=[],this._eventEmitter=new b,this._cachedEvent=new E("",null),this.container=t,this.svgdoc=document,this.updateBoardPosition(),this.svgroot=this.svgdoc.createElementNS(p,"svg");var r={xmlns:"http://www.w3.org/2000/svg",id:"svgroot",xlinks:"http://www.w3.org/1999/xlink",width:this.curConfig.dimensions[0],height:this.curConfig.dimensions[1],overflow:"visible"};Object.keys(r).forEach((function(t){n.svgroot.setAttribute(t,r[t])}));var s={id:"svgBg",width:this.curConfig.dimensions[0],height:this.curConfig.dimensions[1],stroke:"#000",fill:"#fbfbfb",style:"pointer-events: none"};this.canvasBg=m(this._svgdoc,s);var a=this.svgdoc.createElementNS(p,"rect"),h={id:"blabla",width:"100%",height:"100%",stroke:"#000",fill:"#f8f8f8",style:"pointer-events: none",x:0,y:0};Object.keys(h).forEach((function(t){a.setAttribute(t,h[t])})),this.canvasBg.append(a),this.svgcontent=m(this.svgdoc,x(x({},r),{id:"svgcontent"})),this.svgroot.append(this.canvasBg),this.svgroot.append(this.svgcontent),this.container.append(this.svgroot),this.initSelector(),this.initEventHandler(),this.initCustomEventHandler(),window.board=this}return Object.defineProperty(t.prototype,"selection",{get:function(){return this._selection},set:function(t){this._selection=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mouseStatus",{get:function(){return this._mouseStatus},set:function(t){this.mouseStatus!=t&&(this._mouseStatus=t,this._cachedEvent.customData={mouseStatus:t},this._eventEmitter.trigger("mouseStatusChange",[this._cachedEvent]))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"eventEmitter",{get:function(){return this._eventEmitter},set:function(t){this._eventEmitter=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"svgdoc",{get:function(){return this._svgdoc},set:function(t){this._svgdoc=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"svgroot",{get:function(){return this._svgroot},set:function(t){this._svgroot=t},enumerable:!1,configurable:!0}),t.prototype.initSelector=function(){this.selector=new w(this)},t.prototype.initEventHandler=function(){var t=this;this.container.addEventListener("mousedown",this.handleMouseDown.bind(this)),this.container.addEventListener("mouseup",this.handleMouseUp.bind(this)),this.container.addEventListener("click",this.handleClick.bind(this)),this.container.addEventListener("dblclick",this.handleDBClick.bind(this)),this.container.addEventListener("mousemove",this.handleMouseMove.bind(this)),document.addEventListener("resize",(function(){t.updateBoardPosition()})),this.container.addEventListener("keydown",this.handleKeyDown.bind(this))},t.prototype.initCustomEventHandler=function(){this._eventEmitter.on("selectStart",this.onSelectStart.bind(this)),this._eventEmitter.on("createElement",this.onCreateElement.bind(this)),this._eventEmitter.on("creating",this.onCreateMove.bind(this)),this._eventEmitter.on("createEnd",this.onCreateEnd.bind(this)),this._eventEmitter.on("changeMode",this.onChangeMode.bind(this)),this._eventEmitter.on("dragStart",this.onDragStart.bind(this)),this._eventEmitter.on("draging",this.onDraging.bind(this)),this._eventEmitter.on("dragEnd",this.onDragEnd.bind(this)),this._eventEmitter.on("rotating",this.onRotating.bind(this)),this._eventEmitter.on("scaleStart",this.onScaleStart.bind(this)),this._eventEmitter.on("scaling",this.onScaling.bind(this)),this._eventEmitter.on("mouseStatusChange",this.onMouseStatusChange.bind(this))},t.prototype.updateBoardPosition=function(){var t=this.container.getBoundingClientRect();this.boardX=t.x,this.boardY=t.y},t.prototype.updateMouseStatus=function(t){if(!this.selection||this.selection.length<1)return!1;var e=[t.clientX-this.boardX,t.clientY-this.boardY],n=e[0],r=e[1],i=this.selectionArea.nearestCornerDistance(new a(n,r)),c=1e7,h=-1;switch(i.forEach((function(t,e){t<c&&(c=t,h=e)})),h){case 0:this.cornerType=s.LT;break;case 1:this.cornerType=s.LB;break;case 2:this.cornerType=s.RB;break;case 3:this.cornerType=s.RT}this.mouseStatus=c<5?o.SCALE:c<10?o.ROTATE:o.DRAG},t.prototype.exportSvg=function(){return""},t.prototype.setSelected=function(t){console.log(t),this.selection=t;var e="elementSelected";t&&0!=t.length?(this.updateSelectionArea(),this._cachedEvent.customData={elements:t,area:this.selectionArea}):e="nothingSelected",this._eventEmitter.trigger(e,[this._cachedEvent])},t.prototype.setMode=function(t){this.currentMode=t,this._cachedEvent.customData={mode:t},this._eventEmitter.trigger("changeMode",[this._cachedEvent])},t.prototype.updateSelectionArea=function(){var t=this.selection;1==t.length?(this.selectionArea.transform=t[0].transform,this.selectionArea.box.set4(0,0,t[0].frameWidth,t[0].frameHeight)):(this.selectionArea.transform.reset(),this.selectionArea.box=c.mergeAll(t.map((function(t){return t.AABB}))))},t.prototype.handleMouseDown=function(t){if(console.log("currentMode: ",this.currentMode),console.log("currentInsertMode: ",this.currentCreateMode),this.MouseDown=!0,this.mouseStartX=t.clientX-this.boardX,this.mouseStartY=t.clientY-this.boardY,this.currentMode===e.CREATE)return this._cachedEvent.mouseEvent=t,this._cachedEvent.name="createElement",this._cachedEvent.customData={type:this.currentCreateMode,startX:this.mouseStartX,startY:this.mouseStartY},void this._eventEmitter.trigger("createElement",[this._cachedEvent]);this._mouseStatus!=o.ROTATE?this._mouseStatus!=o.SCALE?this.selection&&this.selection.length>=1&&this.clickOnSelectedArea(t)||this.clickOnElement(new a(this.mouseStartX,this.mouseStartY))?this.setMode(e.DRAG):(this.setMode(e.SELECT),this._cachedEvent.mouseEvent=t,this._cachedEvent.name="selectStart",this._eventEmitter.trigger("selectStart",[this._cachedEvent])):this.setMode(e.SCALE):this.setMode(e.ROTATE)},t.prototype.handleMouseUp=function(t){console.log("mouse up..."),this.MouseDown=!1,this.currentMode===e.CREATE?(this._cachedEvent.name="createEnd",this._cachedEvent.mouseEvent=t,this._eventEmitter.trigger("createEnd",[this._cachedEvent])):this.currentMode==e.SELECT&&(this._cachedEvent.name="selectEnd",this._cachedEvent.mouseEvent=t,this._eventEmitter.trigger("selectEnd",[this._cachedEvent])),this.currentMode=e.SELECT},t.prototype.handleMouseMove=function(t){this.updateMouseStatus(t),this.currentMode===e.CREATE&&this.MouseDown?(this._cachedEvent.mouseEvent=t,this._cachedEvent.customData={startX:this.mouseStartX,startY:this.mouseStartY,endX:t.clientX-this.boardX,endY:t.clientY-this.boardY},this._eventEmitter.trigger("creating",[this._cachedEvent])):this.currentMode==e.DRAG?(this._cachedEvent.mouseEvent=t,this._cachedEvent.customData={startX:this.mouseStartX,startY:this.mouseStartY,endX:t.clientX-this.boardX,endY:t.clientY-this.boardY},this._eventEmitter.trigger("draging",[this._cachedEvent])):this.currentMode==e.ROTATE?(this._cachedEvent.mouseEvent=t,this._cachedEvent.customData={startX:this.mouseStartX,startY:this.mouseStartY,endX:t.clientX-this.boardX,endY:t.clientY-this.boardY},this._eventEmitter.trigger("rotating",[this._cachedEvent])):this.currentMode==e.SCALE?(this._cachedEvent.mouseEvent=t,this._cachedEvent.customData={startX:this.mouseStartX,startY:this.mouseStartY,endX:t.clientX-this.boardX,endY:t.clientY-this.boardY},this._eventEmitter.trigger("scaling",[this._cachedEvent])):this.MouseDown&&(this._cachedEvent.mouseEvent=t,this._cachedEvent.customData={startX:this.mouseStartX,startY:this.mouseStartY,endX:t.clientX-this.boardX,endY:t.clientY-this.boardY},this._eventEmitter.trigger("selectMove",[this._cachedEvent]))},t.prototype.handleClick=function(t){},t.prototype.handleDBClick=function(t){},t.prototype.handleKeyDown=function(t){switch(t.key){case"r":this.setMode(e.CREATE),this.currentCreateMode=r.RECT;break;case"o":this.setMode(e.CREATE),this.currentCreateMode=r.ELLIPSE;break;case"l":this.setMode(e.CREATE),this.currentCreateMode=r.LINE;break;case"v":this.setMode(e.SELECT),this.currentCreateMode=r.LINE}},t.prototype.onSelectStart=function(t){},t.prototype.onSelectMove=function(t){},t.prototype.onSelectEnd=function(t){},t.prototype.onCreateElement=function(t){t.mouseEvent;var e=t.customData;switch(e.type){case r.RECT:var n=new _(e.startX,e.startY,0,0);this.svgcontent.append(n.domInstance),this.elements.push(n),this.setSelected([n]);break;case r.ELLIPSE:var i=new v(e.startX,e.startY,0,0);this.svgcontent.append(i.domInstance),this.elements.push(i),this.setSelected([i]);break;default:h.Error("error insert mode")}},t.prototype.onCreateMove=function(t){this.updateSelectionArea(),this.container.className&&(this.container.className=""),console.log("handle create move..."),t.mouseEvent;var e=t.customData,n=[Math.abs(e.endX-e.startX),Math.abs(e.endY-e.startY)],r=n[0],i=n[1];this.selection[0].setFrameWidth(r),this.selection[0].setFrameHeight(i),this.selection[0].transform.e=Math.min(e.endX,e.startX),this.selection[0].transform.f=Math.min(e.endY,e.startY),this.selection[0].updateRendering(),this._eventEmitter.trigger("elementSelected",[this._cachedEvent])},t.prototype.onCreateEnd=function(t){console.log("create element end...")},t.prototype.onDragStart=function(t){},t.prototype.onDraging=function(t){var e=this,n=(t.mouseEvent,t.customData),r=n.startX,i=n.startY,o=n.endX,s=n.endY;this.selection.forEach((function(t,n){t.transform.e=e.selectionTransforms[n].e+o-r,t.transform.f=e.selectionTransforms[n].f+s-i,t.updateRendering()}))},t.prototype.onDragEnd=function(t){},t.prototype.onRotateStart=function(t){},t.prototype.onRotating=function(t){var e=this,n=(t.mouseEvent,t.customData),r=n.startX,i=n.startY,o=n.endX,s=n.endY,c=this.selectionArea.center(),h=new a(r-c.x,i-c.y),u=new a(o-c.x,s-c.y),d=h.angle(u),f=h.crossMultiply(u);d=f>0?d:2*Math.PI-d,this.selection.forEach((function(t,n){t.transform.copy(e.selectionTransforms[n].clone().rotate(d,c)),t.updateRendering()})),this.updateSelectionArea()},t.prototype.onRotateEnd=function(t){},t.prototype.onScaleStart=function(t){this.lastFrameWidth=this.selection[0].frameWidth,this.lastFrameHeight=this.selection[0].frameHeight;var e=1,n=1;switch(this.cornerType){default:case s.RB:break;case s.RT:n=-1;break;case s.LB:e=-1;break;case s.LT:e=n=-1}this.fx=e,this.fy=n},t.prototype.onScaling=function(t){var e=this,n=(t.mouseEvent,t.customData),r=n.startX,i=n.startY,o=n.endX,s=n.endY,c=new a(r,i),h=new a(o,s),u=this.fx,d=this.fy;this.selection.forEach((function(t,n){c.applyTransform(e.selectionTransforms[n].inverse()),h.applyTransform(e.selectionTransforms[n].inverse()),h.subtract(c);var r=[u*h.x/e.lastFrameWidth+1,d*h.y/e.lastFrameHeight+1],i=r[0],o=r[1],s=[Math.max(Math.abs(i),.001),Math.max(Math.abs(o),.001)],f=s[0],l=s[1];i=i<0?-f:f,o=o<0?-l:l,t.transform.copy(e.selectionTransforms[n].clone().scale(i,o,new a(-1==u?e.lastFrameWidth:0,-1==d?e.lastFrameHeight:0))),t.updateRendering()})),this.updateSelectionArea()},t.prototype.onScaleEnd=function(t){},t.prototype.onChangeMode=function(t){var n=t.customData;console.log("change mode:",n.mode),n.mode===e.SELECT?this.setSelected([]):this.currentMode===e.CREATE?this.container.className="cursor-crosshair":this.currentMode==e.DRAG?(this.selectionTransforms=this.selection.map((function(t){return t.transform.clone()})),this._cachedEvent.customData={transforms:this.selectionTransforms},this._eventEmitter.trigger("dragStart",[this._cachedEvent])):this.currentMode==e.ROTATE?(this.selectionTransforms=this.selection.map((function(t){return t.transform.clone()})),this._cachedEvent.customData={transforms:this.selectionTransforms},this._eventEmitter.trigger("rotateStart",[this._cachedEvent])):this.currentMode==e.SCALE&&(this.selectionTransforms=this.selection.map((function(t){return t.transform.clone()})),this._cachedEvent.customData={transforms:this.selectionTransforms},this._eventEmitter.trigger("scaleStart",[this._cachedEvent]))},t.prototype.onMouseStatusChange=function(t){switch(t.customData.mouseStatus){default:case o.DRAG:this.container.className="";break;case o.ROTATE:this.container.className="cursor-move";break;case o.SCALE:this.container.className="cursor-resize"}},t.prototype.clickOnSelectedArea=function(t){return this.selectionArea.include(new a(t.clientX-this.boardX,t.clientY-this.boardY))},t.prototype.clickOnElement=function(t){var e=this.elements.sort((function(t,e){return t.zIndex>e.zIndex?1:-1})).find((function(e){return new d(new c(0,0,e.frameWidth,e.frameHeight),e.transform).include(t)}));return this.setSelected(e?[e]:[]),!!e},t.idPrefix="svg",t}();!function(t){t.SELECT="SELECT",t.DRAG="DRAG",t.ROTATE="ROTATE",t.SCALE="SCALE",t.CREATE="CREATE",t.DRAW="DRAW"}(e||(e={})),function(t){t.RECT="RECT",t.ELLIPSE="ELLIPsE",t.LINE="LINE"}(r||(r={})),function(t){t[t.CASUAL=0]="CASUAL",t[t.SCALE=1]="SCALE"}(i||(i={})),function(t){t[t.DRAG=0]="DRAG",t[t.SCALE=1]="SCALE",t[t.ROTATE=2]="ROTATE"}(o||(o={})),function(t){t[t.LT=0]="LT",t[t.LM=1]="LM",t[t.LB=2]="LB",t[t.CT=3]="CT",t[t.CM=4]="CM",t[t.CB=5]="CB",t[t.RT=6]="RT",t[t.RM=7]="RM",t[t.RB=8]="RB"}(s||(s={})),function(){function t(){}t.getInstance=function(){return t.instance||(t.instance=new t),t.instance},t.instance=null}();var C=n(379),T=n.n(C),R=n(795),O=n.n(R),D=n(569),Y=n.n(D),L=n(565),X=n.n(L),j=n(216),B=n.n(j),k=n(589),P=n.n(k),I=n(424),H={};H.styleTagTransform=P(),H.setAttributes=X(),H.insert=Y().bind(null,"head"),H.domAPI=O(),H.insertStyleElement=B(),T()(I.Z,H),I.Z&&I.Z.locals&&I.Z.locals,console.log("entry index.ts"),new M(document.body)})()})();
//# sourceMappingURL=index.js.map