(()=>{"use strict";var t={424:(t,e,n)=>{n.d(e,{Z:()=>a});var o=n(537),r=n.n(o),i=n(645),s=n.n(i)()(r());s.push([t.id,"html,\nbody {\n  margin: 0;\n  padding: 0;\n}\n\n.cursor-crosshair {\n  cursor: crosshair;\n}\n.cursor-pointer {\n  cursor: pointer;\n}\n.cursor-default {\n  cursor: default;\n}\n.cursor-grab {\n  cursor: grab;\n}\n.cursor-resize {\n  cursor: nwse-resize;\n}\n.cursor-move {\n  cursor: move;\n}\n/* .cursor-rotate {\n  cursor: url(rotate.svg), url(rotate.svg) 0s 0, progress;\n} */\n\n/* @todo: change this */\n.cursor-rotate {\n  cursor: move;\n}\n","",{version:3,sources:["webpack://./src/index.css"],names:[],mappings:"AAAA;;EAEE,SAAS;EACT,UAAU;AACZ;;AAEA;EACE,iBAAiB;AACnB;AACA;EACE,eAAe;AACjB;AACA;EACE,eAAe;AACjB;AACA;EACE,YAAY;AACd;AACA;EACE,mBAAmB;AACrB;AACA;EACE,YAAY;AACd;AACA;;GAEG;;AAEH,uBAAuB;AACvB;EACE,YAAY;AACd",sourcesContent:["html,\nbody {\n  margin: 0;\n  padding: 0;\n}\n\n.cursor-crosshair {\n  cursor: crosshair;\n}\n.cursor-pointer {\n  cursor: pointer;\n}\n.cursor-default {\n  cursor: default;\n}\n.cursor-grab {\n  cursor: grab;\n}\n.cursor-resize {\n  cursor: nwse-resize;\n}\n.cursor-move {\n  cursor: move;\n}\n/* .cursor-rotate {\n  cursor: url(rotate.svg), url(rotate.svg) 0s 0, progress;\n} */\n\n/* @todo: change this */\n.cursor-rotate {\n  cursor: move;\n}\n"],sourceRoot:""}]);const a=s},645:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n="",o=void 0!==e[5];return e[4]&&(n+="@supports (".concat(e[4],") {")),e[2]&&(n+="@media ".concat(e[2]," {")),o&&(n+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),n+=t(e),o&&(n+="}"),e[2]&&(n+="}"),e[4]&&(n+="}"),n})).join("")},e.i=function(t,n,o,r,i){"string"==typeof t&&(t=[[null,t,void 0]]);var s={};if(o)for(var a=0;a<this.length;a++){var c=this[a][0];null!=c&&(s[c]=!0)}for(var h=0;h<t.length;h++){var u=[].concat(t[h]);o&&s[u[0]]||(void 0!==i&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=i),n&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=n):u[2]=n),r&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=r):u[4]="".concat(r)),e.push(u))}},e}},537:t=>{t.exports=function(t){var e=t[1],n=t[3];if(!n)return e;if("function"==typeof btoa){var o=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),r="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(o),i="/*# ".concat(r," */"),s=n.sources.map((function(t){return"/*# sourceURL=".concat(n.sourceRoot||"").concat(t," */")}));return[e].concat(s).concat([i]).join("\n")}return[e].join("\n")}},379:t=>{var e=[];function n(t){for(var n=-1,o=0;o<e.length;o++)if(e[o].identifier===t){n=o;break}return n}function o(t,o){for(var i={},s=[],a=0;a<t.length;a++){var c=t[a],h=o.base?c[0]+o.base:c[0],u=i[h]||0,l="".concat(h," ").concat(u);i[h]=u+1;var p=n(l),d={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==p)e[p].references++,e[p].updater(d);else{var f=r(d,o);o.byIndex=a,e.splice(a,0,{identifier:l,updater:f,references:1})}s.push(l)}return s}function r(t,e){var n=e.domAPI(e);return n.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;n.update(t=e)}else n.remove()}}t.exports=function(t,r){var i=o(t=t||[],r=r||{});return function(t){t=t||[];for(var s=0;s<i.length;s++){var a=n(i[s]);e[a].references--}for(var c=o(t,r),h=0;h<i.length;h++){var u=n(i[h]);0===e[u].references&&(e[u].updater(),e.splice(u,1))}i=c}}},569:t=>{var e={};t.exports=function(t,n){var o=function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}(t);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(n)}},216:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},565:(t,e,n)=>{t.exports=function(t){var e=n.nc;e&&t.setAttribute("nonce",e)}},795:t=>{t.exports=function(t){var e=t.insertStyleElement(t);return{update:function(n){!function(t,e,n){var o="";n.supports&&(o+="@supports (".concat(n.supports,") {")),n.media&&(o+="@media ".concat(n.media," {"));var r=void 0!==n.layer;r&&(o+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),o+=n.css,r&&(o+="}"),n.media&&(o+="}"),n.supports&&(o+="}");var i=n.sourceMap;i&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),e.styleTagTransform(o,t,e.options)}(e,t,n)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},589:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}}},e={};function n(o){var r=e[o];if(void 0!==r)return r.exports;var i=e[o]={id:o,exports:{}};return t[o](i,i.exports,n),i.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var o in e)n.o(e,o)&&!n.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.nc=void 0,(()=>{var t,e=function(){function t(t,e){this._x=t,this._y=e}return Object.defineProperty(t.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mod",{get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},enumerable:!1,configurable:!0}),t.ones=function(){return new t(1,1)},t.zeros=function(){return new t(0,0)},t.prototype.add=function(t){return this._x+=t.x,this._y+=t.y,this},t.prototype.subtract=function(t){return this._x-=t.x,this._y-=t.y,this},t.prototype.dotMultiply=function(t){return this._x*=t.x,this._y*=t.y,this},t.prototype.crossMultiply=function(t){return this._x*t.y-this._y*t.x},t.prototype.angle=function(t){return Math.acos(Math.min((this._x*t.x+this._y*t.y)/this.mod/t.mod,1))},t.prototype.distance=function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))},t.prototype.rotateAtOrigin=function(t){var e=[this.x*Math.cos(t)-this.y*Math.sin(t),this.x*Math.sin(t)+this.y*Math.cos(t)],n=e[0],o=e[1];return this.x=n,this.y=o,this},t.prototype.applyTransform=function(t){var e=t.a,n=t.b,o=t.c,r=t.d,i=t.e,s=t.f,a=[e*this.x+o*this.y+i,n*this.x+r*this.y+s],c=a[0],h=a[1];return this.x=c,this.y=h,this},t.prototype.opposite=function(){return new t(-this._x,-this._y)},t.prototype.clone=function(){return new t(this.x,this.y)},t}(),o=function(){function t(t,e,n,o){this.x=t,this.y=e,this.w=n,this.h=o}return Object.defineProperty(t.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"w",{get:function(){return this._w},set:function(t){this._w=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"h",{get:function(){return this._h},set:function(t){this._h=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"x2",{get:function(){return this._x+this._w},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y2",{get:function(){return this._y+this._h},enumerable:!1,configurable:!0}),t.prototype.set=function(t){this.x=t.x,this.y=t.y,this.w=t.w,this.h=t.h},t.prototype.set4=function(t,e,n,o){this.x=t,this.y=e,this.w=n,this.h=o},t.prototype.setSize=function(t,e){this.w=t,this.h=e},t.prototype.clone=function(){return new t(this.x,this.y,this._w,this._h)},t.prototype.merge=function(t){},t.mergeAll=function(e){if(0==e.length)return null;if(1==e.length)return e[0];var n=Math.min.apply(Math,e.map((function(t){return t.x}))),o=Math.max.apply(Math,e.map((function(t){return t.x+t.w}))),r=Math.min.apply(Math,e.map((function(t){return t.y})));return new t(n,r,o-n,Math.max.apply(Math,e.map((function(t){return t.y+t.h})))-r)},t.prototype.center=function(){return new e(this.x+this.w/2,this.y+this.h/2)},t.prototype.toVector2=function(){return[new e(this.x,this.y),new e(this.x,this.y2),new e(this.x2,this.y2),new e(this.x2,this.y)]},t}(),r=function(){function t(t,e,n,o,r,i){this.a=t,this.b=e,this.c=n,this.d=o,this.e=r,this.f=i}return Object.defineProperty(t.prototype,"rotation",{get:function(){var t=Math.acos(this.a/Math.sqrt(this.a*this.a+this.c*this.c));return this.c>0?2*Math.PI-t:t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotationTransform",{get:function(){return t.fromAngle(this.rotation)},enumerable:!1,configurable:!0}),t.identity=function(){return new t(1,0,0,1,0,0)},t.from=function(e){return new t(e.a,e.b,e.c,e.d,e.e,e.f)},t.fromAngle=function(e){return new t(Math.cos(e),Math.sin(e),-Math.cos(e),Math.sin(e),0,0)},t.prototype.set=function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.e=t.e,this.f=t.f},t.prototype.setFromArray=function(t){this.a=t[0],this.b=t[1],this.c=t[2],this.d=t[3],this.e=t[4],this.f=t[5]},t.prototype.copy=function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.e=t.e,this.f=t.f,this},t.prototype.clone=function(){return t.from(this)},t.prototype.reset=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this},t.prototype.equal=function(t){return this.a===t.a&&this.b===t.b&&this.c===t.c&&this.d===t.d&&this.e===t.e&&this.f===t.f},t.prototype.translate=function(t){return this.translate2(t.x,t.y)},t.prototype.translate2=function(t,e){return this.e+=t,this.f+=e,this},t.prototype.rotateAtOrigin=function(e){var n=[Math.sin(e),Math.cos(e)],o=n[0],r=n[1];return this.rightMultiply(new t(r,o,-o,r,0,0))},t.prototype.rotate=function(t,n){return this.translate(e.zeros().subtract(n)).rotateAtOrigin(t).translate(n)},t.prototype.scale=function(e,n,o){return this.copy(t.identity().translate(o.opposite()).scaleAtOrigin(e,n).translate(o).rightMultiply(this))},t.prototype.scale2=function(t,e,n){return this.translate(n.opposite()).scale2AtOrigin(t,e).translate(n)},t.prototype.scale2AtOrigin=function(e,n){return this.rightMultiply(new t(e,0,0,n,0,0))},t.prototype.scaleAtOrigin=function(t,e){return this.a*=t,this.e*=t,this.d*=e,this.f*=e,this},t.prototype.flipY=function(){var e=this,n=e.a,o=e.b,r=e.c,i=e.d,s=e.e,a=e.f,c=[.5,.5],h=c[0],u=c[1],l=[n*h+r*u+s,o*h+i*u+a][0];return this.rightMultiply(new t(-1,0,0,1,0,0)).translate2(2*l,0),this},t.prototype.rightMultiply=function(t){var e=t.a*this.a+t.c*this.b,n=t.b*this.a+t.d*this.b,o=t.a*this.c+t.c*this.d,r=t.b*this.c+t.d*this.d,i=t.a*this.e+t.c*this.f+t.e,s=t.b*this.e+t.d*this.f+t.f;return this.a=e,this.b=n,this.c=o,this.d=r,this.e=i,this.f=s,this},t.prototype.leftMultiply=function(t){},t.prototype.inverse=function(){var e=this,n=e.a,o=e.b,r=e.c,i=e.d,s=e.e,a=e.f,c=n*i-o*r;return new t(i/c,-o/c,-r/c,n/c,(r*a-i*s)/c,(o*s-n*a)/c)},t.prototype.cssString=function(){return"matrix(".concat(this.a,",").concat(this.b,",").concat(this.c,",").concat(this.d,",").concat(this.e,",").concat(this.f,")")},t}(),i=function(){function t(t,e){this.box=t,this.transform=e}return Object.defineProperty(t.prototype,"box",{get:function(){return this._box},set:function(t){this._box=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transform",{get:function(){return this._transform},set:function(t){this._transform=t},enumerable:!1,configurable:!0}),t.prototype.clone=function(){return new t(this.box.clone(),this.transform.clone())},t.prototype.include=function(t){var e=t.clone().applyTransform(this._transform.inverse());return e.x<this.box.x2&&e.x>this.box.x&&e.y<this.box.y2&&e.y>this.box.y},t.prototype.nearestCornerDistance=function(t){var n=this;return[new e(this.box.x,this.box.y),new e(this.box.x,this.box.y2),new e(this.box.x2,this.box.y2),new e(this.box.x2,this.box.y)].map((function(t){return t.applyTransform(n._transform)})).map((function(e){return e.distance(t)}))},t.prototype.center=function(){return this.box.center().clone().applyTransform(this.transform)},t}(),s="http://www.w3.org/2000/svg",a=function(t,e){var n=t.createElementNS(s,"svg");if(e)return Object.keys(e).forEach((function(t){n.setAttribute(t,e[t])})),n},c=function(t,e){Object.keys(e).forEach((function(n){t.setAttribute(n,e[n])}))},h=1e5,u=function(){var t=navigator.userAgent.toLowerCase();return/macintosh|mac os x/i.test(t)},l=function(){function t(){this.callbacks={}}return t.prototype.on=function(t,e){return void 0===t?(console.warn("wrong names"),!1):void 0===e?(console.warn("wrong callback"),!1):((this.callbacks[t]||(this.callbacks[t]=[])).push(e),this)},t.prototype.off=function(t){return void 0===t?(console.warn("wrong name"),!1):(this.callbacks[t]instanceof Array&&delete this.callbacks[t],this)},t.prototype.trigger=function(t,e){var n=this;if(void 0===t)return console.warn("wrong name"),!1;var o=e instanceof Array?e:[];this.callbacks[t]&&this.callbacks[t].forEach((function(t){t.apply(n,o)}))},t}();!function(t){t.MouseDown="MouseDown",t.MouseMove="MouseMove",t.MouseUp="MouseUp",t.KeyDown="KeyDown",t.SelectStart="SelectStart",t.Selecting="Selecting",t.SelectEnd="SelectEnd",t.CreateStart="CreateStart",t.Creating="Creating",t.CreateEnd="CreateEnd",t.DragStart="DragStart",t.Draging="Draging",t.DragEnd="DragEnd",t.RotateStart="RotateStart",t.Rotating="Rotating",t.RotateEnd="RotateEnd",t.ScaleStart="ScaleStart",t.Scaling="Scaling",t.ScaleEnd="ScaleEnd",t.ChangeMode="ChangeMode",t.ElementSelected="ElementSelected",t.NothingSelected="NothingSelected",t.MouseStatusChange="MouseStatusChange",t.ElementChangeStart="ElementChangeStart",t.ElementChangeEnd="ElementChangeEnd",t.ElementChanged="ElementChanged",t.Undo="Undo",t.Redo="Redo"}(t||(t={}));var p,d=function(){function t(t,e){this.name=t,this.originEvent=e,this.elements=[]}return Object.defineProperty(t.prototype,"elements",{get:function(){return this._elements},set:function(t){this._elements=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},set:function(t){this._name=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"originEvent",{get:function(){return this._originEvent},set:function(t){this._originEvent=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"customData",{get:function(){return this._customData},set:function(t){this._customData=t},enumerable:!1,configurable:!0}),t}(),f=function(){function e(e,n,s,a){this.id="node-"+h++,this.transform=r.identity(),this.transform.a=s,this.transform.d=a,this.transform.translate2(e,n),this.board=window.board,this.AABB=new o(e,n,s,a),this.area=new i(new o(0,0,1,1),this.transform),this.zIndex=0,this.board.eventEmitter.on(t.CreateStart,this.onCreateStart.bind(this)),this.board.eventEmitter.on(t.Creating,this.onCreating.bind(this)),this.board.eventEmitter.on(t.CreateEnd,this.onCreateEnd.bind(this))}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},set:function(t){this._id=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"area",{get:function(){return this._area},set:function(t){this._area=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"domInstance",{get:function(){return this._domInstance||this.createDomInstance(),this._domInstance},set:function(t){this._domInstance=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"frameWidth",{get:function(){return this.transform.a},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"frameHeight",{get:function(){return this.transform.d},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transform",{get:function(){return this._transform},set:function(t){this._transform=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastTransform",{get:function(){return this._lastTransform},set:function(t){this._lastTransform=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"AABB",{get:function(){return this._AABB},set:function(t){this._AABB=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zIndex",{get:function(){return this._zIndex},set:function(t){this._zIndex=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"points",{get:function(){return this._points},set:function(t){this._points=t},enumerable:!1,configurable:!0}),e.prototype.onCreateStart=function(){},e.prototype.onCreating=function(){this.board.selection[0]},e.prototype.onCreateEnd=function(){},e.prototype.updatePoints=function(){var t=this,e=this.area.box.toVector2();this.points=e.map((function(e){return e.applyTransform(t.transform)}))},e.prototype.updateAABB=function(){var t=Math.min.apply(Math,this.points.map((function(t){return t.x}))),e=Math.min.apply(Math,this.points.map((function(t){return t.y}))),n=Math.max.apply(Math,this.points.map((function(t){return t.x}))),o=Math.max.apply(Math,this.points.map((function(t){return t.y})));this.AABB.set4(t,e,n-t,o-e)},e}(),m="#d9d9d9",y=(p=function(t,e){return p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},p(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}p(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),g=function(t){function e(e,n,o,r){var i=t.call(this,e,n,o,r)||this;return i.attr={cx:0,cy:0,rx:.5,ry:.5},i}return y(e,t),e.prototype.createDomInstance=function(){var t=document.createElementNS(s,"ellipse");c(t,this.attr),c(t,{fill:m}),this._domInstance=t},e.prototype.updateAttr=function(){this.attr={cx:0,cy:0,rx:.5,ry:.5}},e.prototype.updateRendering=function(){this.updateAttr(),this.updatePoints(),this.updateAABB(),c(this._domInstance,this.attr);var t=new r(1,0,0,1,.5,.5).rightMultiply(this._transform),e=t.a,n=t.b,o=t.c,i=t.d,s=t.e,a=t.f;c(this._domInstance,{transform:"matrix(".concat(e,",").concat(n,",").concat(o,",").concat(i,",").concat(s,",").concat(a,")")})},e.prototype.onCreateStart=function(){},e.prototype.onCreating=function(){},e.prototype.onCreateEnd=function(){},e}(f),v=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),b=function(t){function e(e,n,o,r){var i=t.call(this,e,n,o,r)||this;return i.attr={x:0,y:0,width:1,height:1},i}return v(e,t),e.prototype.createDomInstance=function(){var t=document.createElementNS(s,"rect");c(t,this.attr),c(t,{fill:m}),this._domInstance=t},e.prototype.updateAttr=function(){this.attr.width=this.frameWidth,this.attr.height=this.frameHeight},e.prototype.updateRendering=function(){this.updatePoints(),this.updateAABB();var t=this._transform,e=t.a,n=t.b,o=t.c,r=t.d,i=t.e,s=t.f;c(this._domInstance,{transform:"matrix(".concat(e,",").concat(n,",").concat(o,",").concat(r,",").concat(i,",").concat(s,")")})},e.prototype.onCreating=function(){this.updateAABB()},e}(f);const E="#009aff";var S=function(){function e(e){this.board=e,this.eventEmitter=this.board.eventEmitter,this.board.eventEmitter.on(t.MouseDown,this.onMouseDown.bind(this)),this.board.eventEmitter.on(t.MouseMove,this.onMouseMove.bind(this)),this.board.eventEmitter.on(t.MouseUp,this.onMouseUp.bind(this))}return e.prototype.onMouseDown=function(t){},e.prototype.onMouseMove=function(t){},e.prototype.onMouseUp=function(t){},e}(),_=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),A=function(){return A=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},A.apply(this,arguments)},C=function(n){function a(e){var a=n.call(this,e)||this;a.board=e,a.container=e.svgroot,a.selectorRoot=e.svgdoc.createElementNS(s,"g"),a.selectRect=e.svgdoc.createElementNS(s,"rect"),a.activeGroup=e.svgdoc.createElementNS(s,"g"),a.selectorRoot.append(a.activeGroup),a.activeMap=new Map,a.manuplator=e.svgdoc.createElementNS(s,"g"),a.selectorRoot.append(a.manuplator),c(a.manuplator,{display:"none"}),a.manuplatorRect=e.svgdoc.createElementNS(s,"path"),c(a.manuplatorRect,{fill:"none","stroke-width":2.5,stroke:E}),a.manuplator.append(a.manuplatorRect),a.manuplatorPoints=e.svgdoc.createElementNS(s,"g"),a.manuplator.append(a.manuplatorPoints);for(var h=0;h<4;h++){var u=e.svgdoc.createElementNS(s,"path");c(u,{fill:"#fcfcfc","stroke-width":1.5,stroke:E}),a.manuplatorPoints.append(u)}return a.lastSelectedNum=0,a.selectArea=new i(new o(0,0,1,1),r.identity()),c(a.selectRect,{fill:"#f00",stroke:"#66c","stroke-width":"0.5","fill-opacity":"0.15",display:"none"}),a.selectorRoot.append(a.selectRect),a.container.append(a.selectorRoot),e.eventEmitter.on(t.SelectStart,a.onSelectStart.bind(a)),e.eventEmitter.on(t.Selecting,a.onSelectMove.bind(a)),e.eventEmitter.on(t.SelectEnd,a.onSelectEnd.bind(a)),e.eventEmitter.on(t.ElementSelected,a.onElemetSelected.bind(a)),e.eventEmitter.on(t.NothingSelected,a.onNothingSelected.bind(a)),e.eventEmitter.on(t.Creating,a.onCreating.bind(a)),e.eventEmitter.on(t.Draging,a.onDraging.bind(a)),e.eventEmitter.on(t.Rotating,a.onRotating.bind(a)),e.eventEmitter.on(t.Scaling,a.onScaling.bind(a)),e.eventEmitter.on(t.ElementChanged,a.onElementChanged.bind(a)),a}return _(a,n),a.prototype.onSelectStart=function(t){c(this.selectRect,{display:"inline"})},a.prototype.onSelectMove=function(t){var e=this,n=Math.min(t.customData.startX,t.customData.endX),o=Math.min(t.customData.startY,t.customData.endY),r=Math.abs(t.customData.endX-t.customData.startX),i=Math.abs(t.customData.endY-t.customData.startY);c(this.selectRect,{x:n,y:o,width:r,height:i}),this.selectArea.box.x=n,this.selectArea.box.y=o,this.selectArea.box.w=r,this.selectArea.box.h=i;var s=[];this.board.elements.forEach((function(t){t.points.find((function(t){return e.selectArea.include(t)}))&&s.push(t)})),this.lastSelectedNum!=s.length&&(this.board.setSelected(s),this.lastSelectedNum=s.length)},a.prototype.onSelectEnd=function(t){this.selectRect.setAttribute("display","none"),this.selectRect.setAttribute("width","0"),this.selectRect.setAttribute("height","0")},a.prototype.onElemetSelected=function(t){this.updateRender()},a.prototype.onNothingSelected=function(t){this.activeMap.forEach((function(t){return c(t,{display:"none"})})),c(this.manuplator,{display:"none"})},a.prototype.onDragStart=function(t){},a.prototype.onCreateStart=function(t){},a.prototype.onCreating=function(t){this.onElemetSelected(t)},a.prototype.onDraging=function(t){this.onElemetSelected(t)},a.prototype.onRotating=function(t){this.updateRender()},a.prototype.onScaling=function(t){this.updateRender()},a.prototype.onElementCreateing=function(t){var e=this.board.selection;if(e&&1===e.length){var n=e[0],o=n.transform,r={x:0,y:0,width:n.frameWidth,height:n.frameHeight};c(this.activeMap.get(e[0].id),A({transform:o.cssString(),display:"inline"},r))}},a.prototype.onElementChanged=function(t){this.updateRender()},a.prototype.updateSelector=function(){},a.prototype.updateRender=function(){this.clear();var t=this.board.selection;if(t){for(var n=function(t){var n=t.transform;if(!o.activeMap.has(t.id)){var r=o.board.svgdoc.createElementNS(s,"path");o.activeMap.set(t.id,r),o.activeGroup.append(r),c(r,{id:t.id,fill:"none",stroke:E,"stroke-width":"2.5","fill-opacity":"0.15",display:"none"})}var i=[e.zeros(),new e(0,1),e.ones(),new e(1,0)];i.forEach((function(t){return t.applyTransform(n)}));var a="M"+i.map((function(t){return t.x+","+t.y})).join("L")+"Z";c(o.activeMap.get(t.id),{display:"inline",d:a})},o=this,r=0,i=t;r<i.length;r++)n(i[r]);if(1===t.length){c(this.manuplator,{display:"inline"});var a=(h=t[0].area.box).toVector2();a.forEach((function(e){return e.applyTransform(t[0].transform)})),c(this.manuplatorRect,{display:"none"}),Array.from(this.manuplatorPoints.children).forEach((function(e,n){c(e,{d:M(a[n].x,a[n].y,6,t[0].transform.rotation)})}))}else if(t.length>=2){c(this.manuplator,{display:"inline"}),c(this.manuplatorRect,{display:"inline"});var h,u=(h=this.board.selectionArea.box).toVector2(),l="M".concat(h.x,",").concat(h.y,"L").concat(h.x,",").concat(h.y2,"L").concat(h.x2,",").concat(h.y2,"L").concat(h.x2,",").concat(h.y,"Z");c(this.manuplator.children[0],{d:l}),Array.from(this.manuplatorPoints.children).forEach((function(t,e){c(t,{d:M(u[e].x,u[e].y,6)})}))}}},a.prototype.clear=function(){this.activeMap.forEach((function(t){return c(t,{display:"none"})}))},a}(S);function M(t,n,o,i){var s=[new e(t-o/2,n-o/2),new e(t-o/2,n+o/2),new e(t+o/2,n+o/2),new e(t+o/2,n-o/2)];return i&&s.forEach((function(o){return o.applyTransform(r.identity().rotate(i,new e(t,n)))})),"M"+s.map((function(t){return t.x+","+t.y})).join("L")+"Z"}var w,x,D,R,T,O,k=function(){function t(){}return t.Error=function(t){console.error(t)},t.Warn=function(t){console.warn(t)},t.Info=function(t){console.info(t)},t.blue=function(t){console.info("%c "+t,"color:blue;")},t.red=function(t){console.info("%c "+t,"color:red;")},t}(),P=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),j=function(n){function o(e){var o=n.call(this,e)||this;return o._cachedEvent=new d("mouseStatusChange",null),o._cachedEvent.customData={},o.eventEmitter.on(t.MouseStatusChange,o.onMouseStatusChange.bind(o)),o}return P(o,n),Object.defineProperty(o.prototype,"cornerType",{get:function(){return this._cornerType},set:function(t){this._cornerType=t},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"mouseStatus",{get:function(){return this._mouseStatus},set:function(e){this._mouseStatus!==e&&(this._mouseStatus=e,this._cachedEvent.customData.mouseStatus=e,this.eventEmitter.trigger(t.MouseStatusChange,[this._cachedEvent]))},enumerable:!1,configurable:!0}),o.prototype.onMouseDown=function(t){},o.prototype.onMouseMove=function(t){this.updateMouseStatus(t)},o.prototype.onMouseUp=function(t){},o.prototype.onMouseStatusChange=function(t){switch(t.customData.mouseStatus){default:case R.DRAG:this.board.container.className="";break;case R.ROTATE:this.board.container.className="cursor-rotate";break;case R.SCALE:this.board.container.className="cursor-resize"}},o.prototype.updateMouseStatus=function(t){if(!this.board.selection||this.board.selection.length<1)return!1;var n=t.customData,o=n.x,r=n.y,i=this.board.selectionArea.nearestCornerDistance(new e(o,r)),s=1/0,a=-1;switch(i.forEach((function(t,e){t<s&&(s=t,a=e)})),a){case 0:this.cornerType=T.LT;break;case 1:this.cornerType=T.LB;break;case 2:this.cornerType=T.RB;break;case 3:this.cornerType=T.RT}this.mouseStatus=s<5?R.SCALE:s<10?R.ROTATE:R.SELECT},o}(S),L=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),B=function(e){function n(n){var o=e.call(this,n)||this;return o.board.eventEmitter.on(t.KeyDown,o.OnKeyDown.bind(o)),o}return L(n,e),n.prototype.OnKeyDown=function(e){var n=e.originEvent,o=u();switch(n.key){case"r":this.board.setMode(w.CREATE),this.board.currentCreateMode=x.RECT;break;case"o":this.board.setMode(w.CREATE),this.board.currentCreateMode=x.ELLIPSE;break;case"l":this.board.setMode(w.CREATE),this.board.currentCreateMode=x.LINE;break;case"v":this.board.setMode(w.SELECT),this.board.currentCreateMode=x.LINE;break;case"z":(o&&n.metaKey||!o&&n.ctrlKey)&&(n.shiftKey?this.board.trigger(t.Redo,e):this.board.trigger(t.Undo,e))}},n}(S),Y=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),X=function(){function t(){}return t.prototype.apply=function(){},t.prototype.unApply=function(){},t}(),I=(Y((function(){return null!==O&&O.apply(this,arguments)||this}),O=X),function(t){function e(e,n,o){var r=t.call(this)||this;return r.element=e,r.oldValues=n,r.newValues={transform:e.transform.clone()},r.info=o||"",r}return Y(e,t),e.prototype.apply=function(){var t=this;Object.entries(this.newValues).forEach((function(e){var n=e[0],o=e[1];"transform"===n&&(t.element.transform=o)})),this.element.updateRendering()},e.prototype.unApply=function(){var t=this;Object.entries(this.oldValues).forEach((function(e){var n=e[0],o=e[1];console.log(n,o),"transform"===n&&(t.element.transform=o)})),this.element.updateRendering()},e}(X)),N=function(t){function e(e){var n=t.call(this)||this;return n.stack=[],n.info=e||"",n}return Y(e,t),e.prototype.apply=function(){this.stack.forEach((function(t){return t&&t.apply()}))},e.prototype.unApply=function(){console.log(this.stack),this.stack.reverse().forEach((function(t){return t&&t.unApply()}))},e.prototype.addSubCommand=function(t){this.stack.push(t)},e}(X),U=function(e){function n(n){var o=e.call(this,n)||this;return o.stack=[],o.undoStackPointer=0,o.undoableChangeStack=[],o.undoChangeStackPointer=-1,o.board.on(t.ElementChangeStart,o.onElementChangeStart.bind(o)),o.board.on(t.ElementChangeEnd,o.onElementChangeEnd.bind(o)),o.board.on(t.Undo,o.onUndo.bind(o)),o.board.on(t.Redo,o.onRedo.bind(o)),o}return Y(n,e),n.prototype.onElementChangeStart=function(t){this.startUndoableChange("transform",this.board.selection)},n.prototype.onElementChangeEnd=function(t){var e=this.endUndoableChange();e&&(this.addCommandToHistory(e),console.log(this.stack))},n.prototype.onUndo=function(e){this.undoStackPointer>0?(this.stack[--this.undoStackPointer].unApply(),this.board.trigger(t.ElementChanged,e)):k.Warn("no action to apply undo..")},n.prototype.onRedo=function(e){console.log("on redo"),console.log(this.undoStackPointer),console.log(this.stack),this.undoStackPointer<this.stack.length&&this.stack.length>0&&(this.stack[this.undoStackPointer++].apply(),this.board.trigger(t.ElementChanged,e))},n.prototype.addCommandToHistory=function(t){this.undoStackPointer<this.stack.length&&this.stack.length>0&&(this.stack=this.stack.splice(0,this.undoStackPointer)),this.stack.push(t),this.undoStackPointer=this.stack.length},n.prototype.startUndoableChange=function(t,e){var n=++this.undoChangeStackPointer,o=e.map((function(t){return t.transform.clone()}));this.undoableChangeStack[n]={attr:t,oldValues:o,elements:e}},n.prototype.endUndoableChange=function(){var t=this.undoChangeStackPointer--,e=this.undoableChangeStack[t],n=e.attr,o=e.elements,r=new N("change elements");return o.forEach((function(t,o){var i={};i[n]=e.oldValues[o],i[n].equal(t.transform)||r.addSubCommand(new I(t,i,n))})),this.undoableChangeStack[t]=null,r},n}(S),z=function(){return z=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},z.apply(this,arguments)},H=function(){function n(t){var e=this;this.boardX=0,this.boardY=0,this.MouseDown=!1,this.mouseStartX=0,this.mouseStartY=0,this.lastZIndex=0,this.container=t,this.saveOptions={},this.selection=[],this.selectionArea=new i(new o(0,0,1,1),r.identity()),this.plugins=[],this.currentMode=w.SELECT,this.currentResizeMode=D.CASUAL,this.rubberBox=null,this.curBBoxes=[],this.curConfig={dimensions:this.getTargetDimensions()},this.elements=[],this.selectionTransforms=[],this.svgdoc=document,this._eventEmitter=new l,this.initEventHandler(),this.initCustomEventHandler(),this._cachedEvent=new d("",null),this._cachedKeyEvent=new d("",null),this.mouseStatusManager=new j(this),this.undoManager=new U(this),this.shotcutManager=new B(this),this.updateBoardPosition(),this.svgroot=this.svgdoc.createElementNS(s,"svg");var n={xmlns:"http://www.w3.org/2000/svg",id:"svgroot",xlinks:"http://www.w3.org/1999/xlink",width:this.curConfig.dimensions[0],height:this.curConfig.dimensions[1],overflow:"visible"};Object.keys(n).forEach((function(t){e.svgroot.setAttribute(t,n[t])}));var c={id:"svgBg",width:this.curConfig.dimensions[0],height:this.curConfig.dimensions[1],stroke:"#000",fill:"#fbfbfb",style:"pointer-events: none"};this.canvasBg=a(this._svgdoc,c);var h=this.svgdoc.createElementNS(s,"rect"),u={id:"blabla",width:"100%",height:"100%",stroke:"#000",fill:"#f8f8f8",style:"pointer-events: none",x:0,y:0};Object.keys(u).forEach((function(t){h.setAttribute(t,u[t])})),this.canvasBg.append(h),this.svgcontent=a(this.svgdoc,z(z({},n),{id:"svgcontent"})),this.svgroot.append(this.canvasBg),this.svgroot.append(this.svgcontent),this.container.append(this.svgroot),this.addInstructions(),this.initSelector(),window.board=this}return Object.defineProperty(n.prototype,"selection",{get:function(){return this._selection},set:function(t){this._selection=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"selectionArea",{get:function(){return this._selectionArea},set:function(t){this._selectionArea=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"container",{get:function(){return this._container},set:function(t){this._container=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"elements",{get:function(){return this._elements},set:function(t){this._elements=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"currentCreateMode",{get:function(){return this._currentCreateMode},set:function(t){this._currentCreateMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"eventEmitter",{get:function(){return this._eventEmitter},set:function(t){this._eventEmitter=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"svgdoc",{get:function(){return this._svgdoc},set:function(t){this._svgdoc=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"svgroot",{get:function(){return this._svgroot},set:function(t){this._svgroot=t},enumerable:!1,configurable:!0}),n.prototype.getTargetDimensions=function(){return[window.innerWidth,window.innerHeight]},n.prototype.updateBoardSize=function(){var t=this;[this.svgroot,this.canvasBg,this.svgcontent].forEach((function(e){c(e,{width:t.curConfig.dimensions[0],height:t.curConfig.dimensions[1]})}))},n.prototype.addInstructions=function(){var t=this._svgdoc.createElementNS(s,"foreignObject");c(t,{x:"0",y:"40%",width:"100%",height:"200"});var e=this._svgdoc.createElement("p"),n=["press R to draw Rectangle","press O to draw Ellipse","press ".concat(u()?"Command":"Ctrl"," + Z to undo"),"press ".concat(u()?"Command":"Ctrl"," + Shift + Z to redo")];e.innerHTML=n.join("<br />"),e.setAttribute("style","text-align: center; color: #bbb; user-select: none"),t.append(e),this.svgroot.append(t)},n.prototype.initSelector=function(){this.selector=new C(this)},n.prototype.initEventHandler=function(){this.container.addEventListener("mousedown",this.handleMouseDown.bind(this)),this.container.addEventListener("mouseup",this.handleMouseUp.bind(this)),this.container.addEventListener("click",this.handleClick.bind(this)),this.container.addEventListener("dblclick",this.handleDBClick.bind(this)),this.container.addEventListener("mousemove",this.handleMouseMove.bind(this)),window.addEventListener("resize",this.handleResize.bind(this)),this.container.addEventListener("keydown",this.handleKeyDown.bind(this))},n.prototype.initCustomEventHandler=function(){this._eventEmitter.on(t.SelectStart,this.onSelectStart.bind(this)),this._eventEmitter.on(t.CreateStart,this.onCreateElement.bind(this)),this._eventEmitter.on(t.Creating,this.onCreateMove.bind(this)),this._eventEmitter.on(t.CreateEnd,this.onCreateEnd.bind(this)),this._eventEmitter.on(t.ChangeMode,this.onChangeMode.bind(this)),this._eventEmitter.on(t.DragStart,this.onDragStart.bind(this)),this._eventEmitter.on(t.Draging,this.onDraging.bind(this)),this._eventEmitter.on(t.DragEnd,this.onDragEnd.bind(this)),this._eventEmitter.on(t.RotateStart,this.onRotateStart.bind(this)),this._eventEmitter.on(t.Rotating,this.onRotating.bind(this)),this._eventEmitter.on(t.RotateEnd,this.onRotateEnd.bind(this)),this._eventEmitter.on(t.ScaleStart,this.onScaleStart.bind(this)),this._eventEmitter.on(t.Scaling,this.onScaling.bind(this)),this._eventEmitter.on(t.ScaleEnd,this.onScaleEnd.bind(this)),this._eventEmitter.on(t.MouseStatusChange,this.onMouseStatusChange.bind(this)),this._eventEmitter.on(t.ElementChanged,this.onElementChanged.bind(this)),this._eventEmitter.on(t.MouseDown,this.onMouseDown.bind(this)),this._eventEmitter.on(t.MouseMove,this.onMouseMove.bind(this)),this._eventEmitter.on(t.MouseUp,this.onMouseUp.bind(this))},n.prototype.updateBoardPosition=function(){var t=this.container.getBoundingClientRect();this.boardX=t.x,this.boardY=t.y},n.prototype.exportSvg=function(){return""},n.prototype.setSelected=function(e){console.log("selection: ",e),this.selection=e;var n=t.ElementSelected;e&&0!=e.length?(this.updateSelectionArea(),this._cachedEvent.customData={elements:e,area:this.selectionArea}):n=t.NothingSelected,this._eventEmitter.trigger(n,[this._cachedEvent])},n.prototype.setMode=function(e){this.currentMode=e,this._cachedEvent.customData={mode:e},this._eventEmitter.trigger(t.ChangeMode,[this._cachedEvent])},n.prototype.updateSelectionArea=function(){var t=this.selection;1==t.length?(this.selectionArea.transform=t[0].transform.clone(),this.selectionArea.box=new o(0,0,1,1)):(this.selectionArea.transform.reset(),this.selectionArea.box=o.mergeAll(t.map((function(t){return t.AABB}))))},n.prototype.on=function(t,e){this._eventEmitter.on(t,e)},n.prototype.trigger=function(t,e){this._eventEmitter.trigger(t,[e])},n.prototype.handleMouseDown=function(e){this.mouseStartX=e.clientX-this.boardX,this.mouseStartY=e.clientY-this.boardY,this._cachedEvent.originEvent=e,this._cachedEvent.customData||(this._cachedEvent.customData={}),this._cachedEvent.customData.x=this.mouseStartX,this._cachedEvent.customData.y=this.mouseStartY,this._eventEmitter.trigger(t.MouseDown,[this._cachedEvent])},n.prototype.handleMouseMove=function(e){var n=[e.clientX-this.boardX,e.clientY-this.boardY],o=n[0],r=n[1];this._cachedEvent.originEvent=e,this._cachedEvent.customData||(this._cachedEvent.customData={}),this._cachedEvent.customData.x=o,this._cachedEvent.customData.y=r,this._eventEmitter.trigger(t.MouseMove,[this._cachedEvent])},n.prototype.handleMouseUp=function(e){this._cachedEvent.originEvent=e,this._cachedEvent.customData.x=e.clientX-this.boardX,this._cachedEvent.customData.y=e.clientY-this.boardY,this._eventEmitter.trigger(t.MouseUp,[this._cachedEvent])},n.prototype.handleClick=function(t){},n.prototype.handleDBClick=function(t){},n.prototype.handleKeyDown=function(e){this._cachedKeyEvent.originEvent=e,this.trigger(t.KeyDown,this._cachedKeyEvent)},n.prototype.handleResize=function(t){this.updateBoardPosition(),this.curConfig.dimensions=this.getTargetDimensions(),this.updateBoardSize()},n.prototype.onMouseDown=function(n){if(console.log("function onMouseDown..."),this.MouseDown=!0,this.currentMode===w.CREATE)return this._cachedEvent.customData={type:this.currentCreateMode,startX:this.mouseStartX,startY:this.mouseStartY},void this._eventEmitter.trigger(t.CreateStart,[this._cachedEvent]);console.log("not create mode..."),this.mouseStatusManager.mouseStatus!=R.ROTATE?(console.log("not rotate mode..."),this.mouseStatusManager.mouseStatus!=R.SCALE?(console.log("not scale mode..."),this.selection&&this.selection.length>=1&&this.clickOnSelectedArea(n)||this.clickOnElement(new e(this.mouseStartX,this.mouseStartY))?this.setMode(w.DRAG):(this.setMode(w.SELECT),this._eventEmitter.trigger(t.SelectStart,[this._cachedEvent]))):this.setMode(w.SCALE)):this.setMode(w.ROTATE)},n.prototype.onMouseMove=function(e){this.currentMode===w.CREATE&&this.MouseDown?(this._cachedEvent.customData={startX:this.mouseStartX,startY:this.mouseStartY,endX:e.customData.x,endY:e.customData.y},this._eventEmitter.trigger(t.Creating,[this._cachedEvent])):this.currentMode==w.DRAG?(this._cachedEvent.customData={startX:this.mouseStartX,startY:this.mouseStartY,endX:e.customData.x,endY:e.customData.y},this._eventEmitter.trigger(t.Draging,[this._cachedEvent])):this.currentMode==w.ROTATE?(this._cachedEvent.customData={startX:this.mouseStartX,startY:this.mouseStartY,endX:e.customData.x,endY:e.customData.y},this._eventEmitter.trigger(t.Rotating,[this._cachedEvent])):this.currentMode==w.SCALE?(this._cachedEvent.customData={startX:this.mouseStartX,startY:this.mouseStartY,endX:e.customData.x,endY:e.customData.y},this._eventEmitter.trigger(t.Scaling,[this._cachedEvent])):this.MouseDown&&(this._cachedEvent.customData={startX:this.mouseStartX,startY:this.mouseStartY,endX:e.customData.x,endY:e.customData.y},this._eventEmitter.trigger(t.Selecting,[this._cachedEvent]))},n.prototype.onMouseUp=function(e){this.MouseDown=!1,this.currentMode===w.CREATE?this._eventEmitter.trigger(t.CreateEnd,[this._cachedEvent]):this.currentMode==w.SELECT?this._eventEmitter.trigger(t.SelectEnd,[this._cachedEvent]):this.currentMode==w.ROTATE?this._eventEmitter.trigger(t.RotateEnd,[this._cachedEvent]):this.currentMode==w.DRAG?this._eventEmitter.trigger(t.DragEnd,[this._cachedEvent]):this.currentMode==w.SCALE&&this._eventEmitter.trigger(t.ScaleEnd,[this._cachedEvent]),this.currentMode=w.SELECT},n.prototype.onSelectStart=function(t){},n.prototype.onSelectMove=function(t){},n.prototype.onSelectEnd=function(t){},n.prototype.onCreateElement=function(t){t.originEvent;var e=t.customData;switch(e.type){case x.RECT:var n=new b(e.startX,e.startY,0,0);this.svgcontent.append(n.domInstance),this.elements.push(n),this.setSelected([n]);break;case x.ELLIPSE:var o=new g(e.startX,e.startY,0,0);this.svgcontent.append(o.domInstance),this.elements.push(o),this.setSelected([o]);break;default:k.Error("error insert mode")}},n.prototype.onCreateMove=function(t){this.updateSelectionArea(),this.container.className&&(this.container.className=""),t.originEvent;var e=t.customData,n=[Math.abs(e.endX-e.startX),Math.abs(e.endY-e.startY)],o=n[0],r=n[1];this.selection[0].transform.a=o,this.selection[0].transform.d=r,this.selection[0].transform.e=Math.min(e.endX,e.startX),this.selection[0].transform.f=Math.min(e.endY,e.startY),this.selection[0].updateRendering()},n.prototype.onCreateEnd=function(t){console.log("create element end...")},n.prototype.onDragStart=function(e){e.elements=this.selection,this.trigger(t.ElementChangeStart,e),this.selectionTransforms=this.selection.map((function(t){return t.transform.clone()})),this.selection.forEach((function(t){return t.lastTransform=t.transform.clone()}))},n.prototype.onDraging=function(t){var e=this,n=(t.originEvent,t.customData),o=n.startX,r=n.startY,i=n.endX,s=n.endY;this.selection.forEach((function(t,n){t.transform.e=e.selectionTransforms[n].e+i-o,t.transform.f=e.selectionTransforms[n].f+s-r,t.updateRendering()})),this.updateSelectionArea()},n.prototype.onDragEnd=function(e){e.elements=this.selection,this.trigger(t.ElementChangeEnd,e)},n.prototype.onRotateStart=function(e){e.elements=this.selection,this.trigger(t.ElementChangeStart,e),this.selectionTransforms=this.selection.map((function(t){return t.transform.clone()})),this.lastSelectionArea=this.selectionArea.clone()},n.prototype.onRotating=function(t){var n=this,o=(t.originEvent,t.customData),r=o.startX,i=o.startY,s=o.endX,a=o.endY,c=this.lastSelectionArea.center(),h=new e(r-c.x,i-c.y),u=new e(s-c.x,a-c.y),l=h.angle(u),p=h.crossMultiply(u);l=p>0?l:2*Math.PI-l,this.selection.forEach((function(t,e){t.transform.copy(n.selectionTransforms[e].clone().rotate(l,c)),t.updateRendering()})),this.updateSelectionArea()},n.prototype.onRotateEnd=function(e){e.elements=this.selection,this.trigger(t.ElementChangeEnd,e),this.updateSelectionArea()},n.prototype.onScaleStart=function(e){e.elements=this.selection,this.trigger(t.ElementChangeStart,e),this.lastFrameWidth=this.selection[0].frameWidth,this.lastFrameHeight=this.selection[0].frameHeight,this.selectionTransforms=this.selection.map((function(t){return t.transform.clone()})),this.lastSelectionArea=this.selectionArea.clone();var n=1,o=1;switch(this.mouseStatusManager.cornerType){default:case T.RB:break;case T.RT:o=-1;break;case T.LB:n=-1;break;case T.LT:n=o=-1}this.fx=n,this.fy=o},n.prototype.onScaling=function(t){var n=this,o=(t.originEvent,t.customData),r=o.startX,i=o.startY,s=o.endX,a=o.endY,c=new e(r,i),h=new e(s,a),u=this.fx,l=this.fy;if(1==this.selection.length){var p=this.selection[0],d=c.clone().applyTransform(this.selectionTransforms[0].inverse()),f=h.clone().applyTransform(this.selectionTransforms[0].inverse());f.subtract(d);var m=[u*f.x+1,l*f.y+1],y=m[0],g=m[1],v=[Math.max(Math.abs(y),.001),Math.max(Math.abs(g),.001)],b=v[0],E=v[1];y=y<0?-b:b,g=g<0?-E:E,p.transform.copy(this.selectionTransforms[0].clone().scale(y,g,new e(-1==u?1:0,-1==l?1:0))),p.updateRendering()}else{var S=[this.lastSelectionArea.box.w,this.lastSelectionArea.box.h],_=S[0],A=S[1],C=h.subtract(c),M=[u*C.x/_+1,l*C.y/A+1],w=M[0],x=M[1],D=[Math.max(Math.abs(w),.001),Math.max(Math.abs(x),.001)];b=D[0],E=D[1],w=w<0?-b:b,x=x<0?-E:E;var R=this.lastSelectionArea.box,T=new e(R.x,R.y).add(new e(-1==u?R.w:0,-1==l?R.h:0));this.selection.forEach((function(t,e){t.transform.copy(n.selectionTransforms[e].clone().scale2(w,x,T)),t.updateRendering()}))}this.updateSelectionArea()},n.prototype.onScaleEnd=function(e){e.elements=this.selection,this.trigger(t.ElementChangeEnd,e),this.updateSelectionArea()},n.prototype.onChangeMode=function(e){var n=e.customData;console.log("change mode:",n.mode),n.mode===w.SELECT?this.setSelected([]):this.currentMode===w.CREATE?this.container.className="cursor-crosshair":this.currentMode==w.DRAG?(this._cachedEvent.customData={transforms:this.selectionTransforms},this._eventEmitter.trigger(t.DragStart,[this._cachedEvent])):this.currentMode==w.ROTATE?(this._cachedEvent.customData={transforms:this.selectionTransforms},this._eventEmitter.trigger(t.RotateStart,[this._cachedEvent])):this.currentMode==w.SCALE&&(this._cachedEvent.customData={transforms:this.selectionTransforms},this._eventEmitter.trigger(t.ScaleStart,[this._cachedEvent]))},n.prototype.onElementChanged=function(t){this.updateSelectionArea()},n.prototype.onMouseStatusChange=function(t){},n.prototype.clickOnSelectedArea=function(t){return this.selectionArea.include(new e(t.customData.x,t.customData.y))},n.prototype.clickOnElement=function(t){var e=this.elements.sort((function(t,e){return t.zIndex>e.zIndex?1:-1})).find((function(e){return new i(new o(0,0,1,1),e.transform).include(t)}));return this.setSelected(e?[e]:[]),!!e},n.idPrefix="svg",n}();!function(t){t.SELECT="SELECT",t.DRAG="DRAG",t.ROTATE="ROTATE",t.SCALE="SCALE",t.CREATE="CREATE",t.DRAW="DRAW"}(w||(w={})),function(t){t.RECT="RECT",t.ELLIPSE="ELLIPsE",t.LINE="LINE"}(x||(x={})),function(t){t[t.CASUAL=0]="CASUAL",t[t.SCALE=1]="SCALE"}(D||(D={})),function(t){t.SELECT="SELECT",t.DRAG="DRAG",t.SCALE="SCALE",t.ROTATE="ROTATE"}(R||(R={})),function(t){t[t.LT=0]="LT",t[t.LM=1]="LM",t[t.LB=2]="LB",t[t.CT=3]="CT",t[t.CM=4]="CM",t[t.CB=5]="CB",t[t.RT=6]="RT",t[t.RM=7]="RM",t[t.RB=8]="RB"}(T||(T={}));var G=n(379),K=n.n(G),Z=n(795),V=n.n(Z),W=n(569),q=n.n(W),F=n(565),J=n.n(F),Q=n(216),$=n.n(Q),tt=n(589),et=n.n(tt),nt=n(424),ot={};ot.styleTagTransform=et(),ot.setAttributes=J(),ot.insert=q().bind(null,"head"),ot.domAPI=V(),ot.insertStyleElement=$(),K()(nt.Z,ot),nt.Z&&nt.Z.locals&&nt.Z.locals,console.log("entry index.ts"),new H(document.body)})()})();
//# sourceMappingURL=index.js.map