(()=>{"use strict";var t={424:(t,e,n)=>{n.d(e,{Z:()=>a});var o=n(537),r=n.n(o),i=n(645),s=n.n(i)()(r());s.push([t.id,"html,\nbody {\n  margin: 0;\n  padding: 0;\n}\n\n.cursor-crosshair {\n  cursor: crosshair;\n}\n.cursor-pointer {\n  cursor: pointer;\n}\n.cursor-default {\n  cursor: default;\n}\n.cursor-grab {\n  cursor: grab;\n}\n.cursor-resize {\n  cursor: nwse-resize;\n}\n.cursor-move {\n  cursor: move;\n}\n","",{version:3,sources:["webpack://./src/index.css"],names:[],mappings:"AAAA;;EAEE,SAAS;EACT,UAAU;AACZ;;AAEA;EACE,iBAAiB;AACnB;AACA;EACE,eAAe;AACjB;AACA;EACE,eAAe;AACjB;AACA;EACE,YAAY;AACd;AACA;EACE,mBAAmB;AACrB;AACA;EACE,YAAY;AACd",sourcesContent:["html,\nbody {\n  margin: 0;\n  padding: 0;\n}\n\n.cursor-crosshair {\n  cursor: crosshair;\n}\n.cursor-pointer {\n  cursor: pointer;\n}\n.cursor-default {\n  cursor: default;\n}\n.cursor-grab {\n  cursor: grab;\n}\n.cursor-resize {\n  cursor: nwse-resize;\n}\n.cursor-move {\n  cursor: move;\n}\n"],sourceRoot:""}]);const a=s},645:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n="",o=void 0!==e[5];return e[4]&&(n+="@supports (".concat(e[4],") {")),e[2]&&(n+="@media ".concat(e[2]," {")),o&&(n+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),n+=t(e),o&&(n+="}"),e[2]&&(n+="}"),e[4]&&(n+="}"),n})).join("")},e.i=function(t,n,o,r,i){"string"==typeof t&&(t=[[null,t,void 0]]);var s={};if(o)for(var a=0;a<this.length;a++){var c=this[a][0];null!=c&&(s[c]=!0)}for(var h=0;h<t.length;h++){var u=[].concat(t[h]);o&&s[u[0]]||(void 0!==i&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=i),n&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=n):u[2]=n),r&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=r):u[4]="".concat(r)),e.push(u))}},e}},537:t=>{t.exports=function(t){var e=t[1],n=t[3];if(!n)return e;if("function"==typeof btoa){var o=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),r="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(o),i="/*# ".concat(r," */"),s=n.sources.map((function(t){return"/*# sourceURL=".concat(n.sourceRoot||"").concat(t," */")}));return[e].concat(s).concat([i]).join("\n")}return[e].join("\n")}},379:t=>{var e=[];function n(t){for(var n=-1,o=0;o<e.length;o++)if(e[o].identifier===t){n=o;break}return n}function o(t,o){for(var i={},s=[],a=0;a<t.length;a++){var c=t[a],h=o.base?c[0]+o.base:c[0],u=i[h]||0,p="".concat(h," ").concat(u);i[h]=u+1;var l=n(p),f={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==l)e[l].references++,e[l].updater(f);else{var d=r(f,o);o.byIndex=a,e.splice(a,0,{identifier:p,updater:d,references:1})}s.push(p)}return s}function r(t,e){var n=e.domAPI(e);return n.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;n.update(t=e)}else n.remove()}}t.exports=function(t,r){var i=o(t=t||[],r=r||{});return function(t){t=t||[];for(var s=0;s<i.length;s++){var a=n(i[s]);e[a].references--}for(var c=o(t,r),h=0;h<i.length;h++){var u=n(i[h]);0===e[u].references&&(e[u].updater(),e.splice(u,1))}i=c}}},569:t=>{var e={};t.exports=function(t,n){var o=function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}(t);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(n)}},216:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},565:(t,e,n)=>{t.exports=function(t){var e=n.nc;e&&t.setAttribute("nonce",e)}},795:t=>{t.exports=function(t){var e=t.insertStyleElement(t);return{update:function(n){!function(t,e,n){var o="";n.supports&&(o+="@supports (".concat(n.supports,") {")),n.media&&(o+="@media ".concat(n.media," {"));var r=void 0!==n.layer;r&&(o+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),o+=n.css,r&&(o+="}"),n.media&&(o+="}"),n.supports&&(o+="}");var i=n.sourceMap;i&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),e.styleTagTransform(o,t,e.options)}(e,t,n)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},589:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}}},e={};function n(o){var r=e[o];if(void 0!==r)return r.exports;var i=e[o]={id:o,exports:{}};return t[o](i,i.exports,n),i.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var o in e)n.o(e,o)&&!n.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.nc=void 0,(()=>{var t,e,o,r,i,s,a=function(){function t(t,e){this._x=t,this._y=e}return Object.defineProperty(t.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mod",{get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},enumerable:!1,configurable:!0}),t.ones=function(){return new t(1,1)},t.zeros=function(){return new t(0,0)},t.prototype.add=function(t){return this._x+=t.x,this._y+=t.y,this},t.prototype.subtract=function(t){return this._x-=t.x,this._y-=t.y,this},t.prototype.dotMultiply=function(t){return this._x*=t.x,this._y*=t.y,this},t.prototype.crossMultiply=function(t){return this._x*t.y-this._y*t.x},t.prototype.angle=function(t){return Math.acos(Math.min((this._x*t.x+this._y*t.y)/this.mod/t.mod,1))},t.prototype.distance=function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))},t.prototype.rotateAtOrigin=function(t){var e=[this.x*Math.cos(t)-this.y*Math.sin(t),this.x*Math.sin(t)+this.y*Math.cos(t)],n=e[0],o=e[1];return this.x=n,this.y=o,this},t.prototype.applyTransform=function(t){var e=t.a,n=t.b,o=t.c,r=t.d,i=t.e,s=t.f,a=[e*this.x+o*this.y+i,n*this.x+r*this.y+s],c=a[0],h=a[1];return this.x=c,this.y=h,this},t.prototype.opposite=function(){return new t(-this._x,-this._y)},t.prototype.clone=function(){return new t(this.x,this.y)},t}(),c=function(){function t(t,e,n,o){this.x=t,this.y=e,this.w=n,this.h=o}return Object.defineProperty(t.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"w",{get:function(){return this._w},set:function(t){this._w=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"h",{get:function(){return this._h},set:function(t){this._h=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"x2",{get:function(){return this._x+this._w},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y2",{get:function(){return this._y+this._h},enumerable:!1,configurable:!0}),t.prototype.set=function(t){this.x=t.x,this.y=t.y,this.w=t.w,this.h=t.h},t.prototype.set4=function(t,e,n,o){this.x=t,this.y=e,this.w=n,this.h=o},t.prototype.setSize=function(t,e){this.w=t,this.h=e},t.prototype.merge=function(t){},t.mergeAll=function(e){if(0==e.length)return null;if(1==e.length)return e[0];var n=Math.min.apply(Math,e.map((function(t){return t.x}))),o=Math.max.apply(Math,e.map((function(t){return t.x+t.w}))),r=Math.min.apply(Math,e.map((function(t){return t.y})));return new t(n,r,o-n,Math.max.apply(Math,e.map((function(t){return t.y+t.h})))-r)},t.prototype.center=function(){return new a(this.x+this.w/2,this.y+this.h/2)},t.prototype.toVector2=function(){return[new a(this.x,this.y),new a(this.x,this.y2),new a(this.x2,this.y2),new a(this.x2,this.y)]},t}(),h=function(){function t(){}return t.Error=function(t){console.error(t)},t.blue=function(t){console.info("%c "+t,"color:blue;")},t.red=function(t){console.info("%c "+t,"color:red;")},t}(),u=function(){function t(t,e,n,o,r,i){this.a=t,this.b=e,this.c=n,this.d=o,this.e=r,this.f=i}return t.identity=function(){return new t(1,0,0,1,0,0)},t.from=function(e){return new t(e.a,e.b,e.c,e.d,e.e,e.f)},t.prototype.set=function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.e=t.e,this.f=t.f},t.prototype.setFromArray=function(t){this.a=t[0],this.b=t[1],this.c=t[2],this.d=t[3],this.e=t[4],this.f=t[5]},t.prototype.copy=function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.e=t.e,this.f=t.f,this},t.prototype.clone=function(){return t.from(this)},t.prototype.reset=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this},t.prototype.translate=function(t){return this.translate2(t.x,t.y)},t.prototype.translate2=function(t,e){return this.e+=t,this.f+=e,this},t.prototype.rotateAtOrigin=function(e){var n=[Math.sin(e),Math.cos(e)],o=n[0],r=n[1];return this.rightMultiply(new t(r,o,-o,r,0,0))},t.prototype.rotate=function(t,e){return this.translate(a.zeros().subtract(e)).rotateAtOrigin(t).translate(e)},t.prototype.scale=function(e,n,o){return this.copy(t.identity().translate(o.opposite()).scaleAtOrigin(e,n).translate(o).rightMultiply(this))},t.prototype.scaleAtOrigin=function(t,e){return this.a*=t,this.e*=t,this.d*=e,this.f*=e,this},t.prototype.flipY=function(){var e=this,n=e.a,o=e.b,r=e.c,i=e.d,s=e.e,a=e.f,c=[.5,.5],h=c[0],u=c[1],p=[n*h+r*u+s,o*h+i*u+a][0];return this.rightMultiply(new t(-1,0,0,1,0,0)).translate2(2*p,0),this},t.prototype.rightMultiply=function(t){var e=t.a*this.a+t.c*this.b,n=t.b*this.a+t.d*this.b,o=t.a*this.c+t.c*this.d,r=t.b*this.c+t.d*this.d,i=t.a*this.e+t.c*this.f+t.e,s=t.b*this.e+t.d*this.f+t.f;return this.a=e,this.b=n,this.c=o,this.d=r,this.e=i,this.f=s,this},t.prototype.leftMultiply=function(t){},t.prototype.inverse=function(){var e=this,n=e.a,o=e.b,r=e.c,i=e.d,s=e.e,a=e.f,c=n*i-o*r;return new t(i/c,-o/c,-r/c,n/c,(r*a-i*s)/c,(o*s-n*a)/c)},t.prototype.cssString=function(){return"matrix(".concat(this.a,",").concat(this.b,",").concat(this.c,",").concat(this.d,",").concat(this.e,",").concat(this.f,")")},t}(),p=function(){function t(t,e){this.box=t,this.transform=e}return Object.defineProperty(t.prototype,"box",{get:function(){return this._box},set:function(t){this._box=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transform",{get:function(){return this._transform},set:function(t){this._transform=t},enumerable:!1,configurable:!0}),t.prototype.include=function(t){var e=t.clone().applyTransform(this._transform.inverse());return e.x<this.box.x2&&e.x>this.box.x&&e.y<this.box.y2&&e.y>this.box.y},t.prototype.nearestCornerDistance=function(t){var e=this;return[new a(this.box.x,this.box.y),new a(this.box.x,this.box.y2),new a(this.box.x2,this.box.y2),new a(this.box.x2,this.box.y)].map((function(t){return t.applyTransform(e._transform)})).map((function(e){return e.distance(t)}))},t.prototype.center=function(){return this.box.center().clone().applyTransform(this.transform)},t}(),l="http://www.w3.org/2000/svg",f=function(t,e){var n=t.createElementNS(l,"svg");if(e)return Object.keys(e).forEach((function(t){n.setAttribute(t,e[t])})),n},d=function(t,e){Object.keys(e).forEach((function(n){t.setAttribute(n,e[n])}))},m=1e5,y=function(){function t(t,e,n,o){this.id="node-"+m++,this.transform=u.identity(),this.transform.a=n,this.transform.d=o,this.transform.translate2(t,e),this.board=window.board,this.AABB=new c(t,e,n,o),this.area=new p(new c(0,0,1,1),this.transform),this.zIndex=0,this.board.eventEmitter.on("createSart",this.onCreateStart.bind(this)),this.board.eventEmitter.on("creating",this.onCreating.bind(this)),this.board.eventEmitter.on("createEnd",this.onCreateEnd.bind(this))}return Object.defineProperty(t.prototype,"id",{get:function(){return this._id},set:function(t){this._id=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"area",{get:function(){return this._area},set:function(t){this._area=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"domInstance",{get:function(){return this._domInstance||this.createDomInstance(),this._domInstance},set:function(t){this._domInstance=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"frameWidth",{get:function(){return this.transform.a},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"frameHeight",{get:function(){return this.transform.d},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transform",{get:function(){return this._transform},set:function(t){this._transform=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"AABB",{get:function(){return this._AABB},set:function(t){this._AABB=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"zIndex",{get:function(){return this._zIndex},set:function(t){this._zIndex=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"points",{get:function(){return this._points},set:function(t){this._points=t},enumerable:!1,configurable:!0}),t.prototype.onCreateStart=function(){},t.prototype.onCreating=function(){h.blue("on creating in baseelement"),this.board.selection[0]},t.prototype.onCreateEnd=function(){},t.prototype.updatePoints=function(){var t=this,e=this.area.box.toVector2();this.points=e.map((function(e){return e.applyTransform(t.transform)}))},t.prototype.updateAABB=function(){var t=Math.min.apply(Math,this.points.map((function(t){return t.x}))),e=Math.min.apply(Math,this.points.map((function(t){return t.y}))),n=Math.max.apply(Math,this.points.map((function(t){return t.x}))),o=Math.max.apply(Math,this.points.map((function(t){return t.y})));this.AABB.set4(t,e,n-t,o-e)},t}(),g="#d9d9d9",v=(t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)},function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}),b=function(t){function e(e,n,o,r){var i=t.call(this,e,n,o,r)||this;return i.attr={cx:0,cy:0,rx:.5,ry:.5},i}return v(e,t),e.prototype.createDomInstance=function(){var t=document.createElementNS(l,"ellipse");d(t,this.attr),d(t,{fill:g}),this._domInstance=t},e.prototype.updateAttr=function(){this.attr={cx:0,cy:0,rx:.5,ry:.5}},e.prototype.updateRendering=function(){this.updateAttr(),this.updatePoints(),this.updateAABB(),d(this._domInstance,this.attr);var t=new u(1,0,0,1,.5,.5).rightMultiply(this._transform),e=t.a,n=t.b,o=t.c,r=t.d,i=t.e,s=t.f;d(this._domInstance,{transform:"matrix(".concat(e,",").concat(n,",").concat(o,",").concat(r,",").concat(i,",").concat(s,")")})},e.prototype.onCreateStart=function(){},e.prototype.onCreating=function(){},e.prototype.onCreateEnd=function(){},e}(y),E=function(){function t(){this.callbacks={}}return t.prototype.on=function(t,e){return void 0===t||""===t?(console.warn("wrong names"),!1):void 0===e?(console.warn("wrong callback"),!1):((this.callbacks[t]||(this.callbacks[t]=[])).push(e),this)},t.prototype.off=function(t){return void 0===t||""===t?(console.warn("wrong name"),!1):(this.callbacks[t]instanceof Array&&delete this.callbacks[t],this)},t.prototype.trigger=function(t,e){var n=this;if(void 0===t||""===t)return console.warn("wrong name"),!1;var o=e instanceof Array?e:[];this.callbacks[t]&&this.callbacks[t].forEach((function(t){t.apply(n,o)}))},t}(),_=function(){function t(t,e){this.name=t,this.mouseEvent=e}return Object.defineProperty(t.prototype,"name",{get:function(){return this._name},set:function(t){this._name=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mouseEvent",{get:function(){return this._mouseEvent},set:function(t){this._mouseEvent=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"customData",{get:function(){return this._customData},set:function(t){this._customData=t},enumerable:!1,configurable:!0}),t}(),A=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),S=function(t){function e(e,n,o,r){var i=t.call(this,e,n,o,r)||this;return i.attr={x:0,y:0,width:1,height:1},i}return A(e,t),e.prototype.createDomInstance=function(){var t=document.createElementNS(l,"rect");d(t,this.attr),d(t,{fill:g}),this._domInstance=t},e.prototype.updateAttr=function(){this.attr.width=this.frameWidth,this.attr.height=this.frameHeight},e.prototype.updateRendering=function(){this.updatePoints(),this.updateAABB();var t=this._transform,e=t.a,n=t.b,o=t.c,r=t.d,i=t.e,s=t.f;d(this._domInstance,{transform:"matrix(".concat(e,",").concat(n,",").concat(o,",").concat(r,",").concat(i,",").concat(s,")")})},e.prototype.onCreating=function(){this.updateAABB()},e}(y),M=function(){function t(t){this.board=t,this.eventEmitter=this.board.eventEmitter,this.board.eventEmitter.on("mouseDown",this.onMouseDown.bind(this)),this.board.eventEmitter.on("mouseMove",this.onMouseMove.bind(this)),this.board.eventEmitter.on("mouseUp",this.onMouseUp.bind(this))}return t.prototype.onMouseDown=function(t){},t.prototype.onMouseMove=function(t){},t.prototype.onMouseUp=function(t){},t}(),w=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),x=function(){return x=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},x.apply(this,arguments)},C=function(t){function e(e){var n=t.call(this,e)||this;return n.board=e,n.container=e.svgroot,n.selectorRoot=e.svgdoc.createElementNS(l,"g"),n.selectRect=e.svgdoc.createElementNS(l,"rect"),n.selectedRectMap=new Map,n.lastSelectedNum=0,n.selectArea=new p(new c(0,0,1,1),u.identity()),d(n.selectRect,{fill:"#f00",stroke:"#66c","stroke-width":"0.5","fill-opacity":"0.15",display:"none"}),n.selectorRoot.append(n.selectRect),n.container.append(n.selectorRoot),e.eventEmitter.on("selectStart",n.onSelectStart.bind(n)),e.eventEmitter.on("selectMove",n.onSelectMove.bind(n)),e.eventEmitter.on("selectEnd",n.onSelectEnd.bind(n)),e.eventEmitter.on("elementSelected",n.onElemetSelected.bind(n)),e.eventEmitter.on("nothingSelected",n.onNothingSelected.bind(n)),e.eventEmitter.on("creating",n.onCreating.bind(n)),e.eventEmitter.on("draging",n.onDraging.bind(n)),e.eventEmitter.on("rotating",n.onRotating.bind(n)),e.eventEmitter.on("scaling",n.onScaling.bind(n)),n}return w(e,t),e.prototype.onSelectStart=function(t){d(this.selectRect,{display:"inline"})},e.prototype.onSelectMove=function(t){var e=this,n=Math.min(t.customData.startX,t.customData.endX),o=Math.min(t.customData.startY,t.customData.endY),r=Math.abs(t.customData.endX-t.customData.startX),i=Math.abs(t.customData.endY-t.customData.startY);d(this.selectRect,{x:n,y:o,width:r,height:i}),this.selectArea.box.x=n,this.selectArea.box.y=o,this.selectArea.box.w=r,this.selectArea.box.h=i;var s=[];this.board.elements.forEach((function(t){t.points.find((function(t){return e.selectArea.include(t)}))&&s.push(t)})),this.lastSelectedNum!=s.length&&(this.board.setSelected(s),this.lastSelectedNum=s.length)},e.prototype.onSelectEnd=function(t){this.selectRect.setAttribute("display","none"),this.selectRect.setAttribute("width","0"),this.selectRect.setAttribute("height","0")},e.prototype.onElemetSelected=function(t){this.updateRender()},e.prototype.onNothingSelected=function(t){this.selectedRectMap.forEach((function(t){return d(t,{display:"none"})}))},e.prototype.onDragStart=function(t){},e.prototype.onCreateStart=function(t){},e.prototype.onCreating=function(t){this.onElemetSelected(t)},e.prototype.onDraging=function(t){this.onElemetSelected(t)},e.prototype.onRotating=function(t){this.updateRender()},e.prototype.onScaling=function(t){this.updateRender()},e.prototype.onElementCreateing=function(t){var e=this.board.selection;if(e&&1===e.length){var n=e[0],o=n.transform,r={x:0,y:0,width:n.frameWidth,height:n.frameHeight};d(this.selectedRectMap.get(e[0].id),x({transform:o.cssString(),display:"inline"},r))}},e.prototype.updateSelector=function(){},e.prototype.updateRender=function(){this.clear();var t=this.board.selection;if(t){t.length;for(var e=function(t){var e=t.transform;if(!n.selectedRectMap.has(t.id)){var o=n.board.svgdoc.createElementNS(l,"path");n.selectedRectMap.set(t.id,o),n.selectorRoot.append(o),d(o,{id:t.id,fill:"none",stroke:"#009aff","stroke-width":"2.5","fill-opacity":"0.15",display:"none"})}var r=[a.zeros(),new a(0,1),a.ones(),new a(1,0)];r.forEach((function(t){return t.applyTransform(e)}));var i="M"+r.map((function(t){return t.x+","+t.y})).join("L")+"Z";d(n.selectedRectMap.get(t.id),{display:"inline",d:i})},n=this,o=0,r=t;o<r.length;o++)e(r[o])}},e.prototype.clear=function(){this.selectedRectMap.forEach((function(t){return d(t,{display:"none"})}))},e}(M),D=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),T=function(t){function e(e){var n=t.call(this,e)||this;return n._cachedEvent=new _("mouseStatusChange",null),n._cachedEvent.customData={},n.eventEmitter.on("mouseStatusChange",n.onMouseStatusChange.bind(n)),n}return D(e,t),Object.defineProperty(e.prototype,"cornerType",{get:function(){return this._cornerType},set:function(t){this._cornerType=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mouseStatus",{get:function(){return this._mouseStatus},set:function(t){this._mouseStatus!==t&&(this._mouseStatus=t,this._cachedEvent.customData.mouseStatus=t,this.eventEmitter.trigger("mouseStatusChange",[this._cachedEvent]))},enumerable:!1,configurable:!0}),e.prototype.onMouseDown=function(t){h.blue("mouse down in MouseStatusManager...")},e.prototype.onMouseMove=function(t){this.updateMouseStatus(t)},e.prototype.onMouseUp=function(t){},e.prototype.onMouseStatusChange=function(t){switch(t.customData.mouseStatus){default:case i.DRAG:this.board.container.className="";break;case i.ROTATE:this.board.container.className="cursor-move";break;case i.SCALE:this.board.container.className="cursor-resize"}},e.prototype.updateMouseStatus=function(t){if(!this.board.selection||this.board.selection.length<1)return!1;var e=t.customData,n=e.x,o=e.y,r=this.board.selectionArea.nearestCornerDistance(new a(n,o)),c=1/0,h=-1;switch(r.forEach((function(t,e){t<c&&(c=t,h=e)})),h){case 0:this.cornerType=s.LT;break;case 1:this.cornerType=s.LB;break;case 2:this.cornerType=s.RB;break;case 3:this.cornerType=s.RT}this.mouseStatus=c<5?i.SCALE:c<10?i.ROTATE:i.SELECT},e}(M),R=function(){return R=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},R.apply(this,arguments)},O=function(){function t(t){var n=this;this.boardX=0,this.boardY=0,this.MouseDown=!1,this.mouseStartX=0,this.mouseStartY=0,this.lastZIndex=0,this.saveOptions={},this.selection=[],this.selectionArea=new p(new c(0,0,1,1),u.identity()),this.plugins=[],this.currentMode=e.SELECT,this.currentResizeMode=r.CASUAL,this.rubberBox=null,this.curBBoxes=[],this.curConfig={dimensions:[800,600]},this.elements=[],this.selectionTransforms=[],this._eventEmitter=new E,this._cachedEvent=new _("",null),this.mouseStatusManager=new T(this),this.container=t,this.svgdoc=document,this.updateBoardPosition(),this.svgroot=this.svgdoc.createElementNS(l,"svg");var o={xmlns:"http://www.w3.org/2000/svg",id:"svgroot",xlinks:"http://www.w3.org/1999/xlink",width:this.curConfig.dimensions[0],height:this.curConfig.dimensions[1],overflow:"visible"};Object.keys(o).forEach((function(t){n.svgroot.setAttribute(t,o[t])}));var i={id:"svgBg",width:this.curConfig.dimensions[0],height:this.curConfig.dimensions[1],stroke:"#000",fill:"#fbfbfb",style:"pointer-events: none"};this.canvasBg=f(this._svgdoc,i);var s=this.svgdoc.createElementNS(l,"rect"),a={id:"blabla",width:"100%",height:"100%",stroke:"#000",fill:"#f8f8f8",style:"pointer-events: none",x:0,y:0};Object.keys(a).forEach((function(t){s.setAttribute(t,a[t])})),this.canvasBg.append(s),this.svgcontent=f(this.svgdoc,R(R({},o),{id:"svgcontent"})),this.svgroot.append(this.canvasBg),this.svgroot.append(this.svgcontent),this.container.append(this.svgroot),this.initSelector(),this.initEventHandler(),this.initCustomEventHandler(),window.board=this}return Object.defineProperty(t.prototype,"selection",{get:function(){return this._selection},set:function(t){this._selection=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selectionArea",{get:function(){return this._selectionArea},set:function(t){this._selectionArea=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"container",{get:function(){return this._container},set:function(t){this._container=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"elements",{get:function(){return this._elements},set:function(t){this._elements=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"eventEmitter",{get:function(){return this._eventEmitter},set:function(t){this._eventEmitter=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"svgdoc",{get:function(){return this._svgdoc},set:function(t){this._svgdoc=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"svgroot",{get:function(){return this._svgroot},set:function(t){this._svgroot=t},enumerable:!1,configurable:!0}),t.prototype.initSelector=function(){this.selector=new C(this)},t.prototype.initEventHandler=function(){var t=this;this.container.addEventListener("mousedown",this.handleMouseDown.bind(this)),this.container.addEventListener("mouseup",this.handleMouseUp.bind(this)),this.container.addEventListener("click",this.handleClick.bind(this)),this.container.addEventListener("dblclick",this.handleDBClick.bind(this)),this.container.addEventListener("mousemove",this.handleMouseMove.bind(this)),document.addEventListener("resize",(function(){t.updateBoardPosition()})),this.container.addEventListener("keydown",this.handleKeyDown.bind(this))},t.prototype.initCustomEventHandler=function(){this._eventEmitter.on("selectStart",this.onSelectStart.bind(this)),this._eventEmitter.on("createElement",this.onCreateElement.bind(this)),this._eventEmitter.on("creating",this.onCreateMove.bind(this)),this._eventEmitter.on("createEnd",this.onCreateEnd.bind(this)),this._eventEmitter.on("changeMode",this.onChangeMode.bind(this)),this._eventEmitter.on("dragStart",this.onDragStart.bind(this)),this._eventEmitter.on("draging",this.onDraging.bind(this)),this._eventEmitter.on("dragEnd",this.onDragEnd.bind(this)),this._eventEmitter.on("rotateStart",this.onRotateStart.bind(this)),this._eventEmitter.on("rotating",this.onRotating.bind(this)),this._eventEmitter.on("rotateEnd",this.onRotateEnd.bind(this)),this._eventEmitter.on("scaleStart",this.onScaleStart.bind(this)),this._eventEmitter.on("scaling",this.onScaling.bind(this)),this._eventEmitter.on("scaleEnd",this.onScaleEnd.bind(this)),this._eventEmitter.on("mouseStatusChange",this.onMouseStatusChange.bind(this)),this._eventEmitter.on("mouseDown",this.onMouseDown.bind(this)),this._eventEmitter.on("mouseMove",this.onMouseMove.bind(this)),this._eventEmitter.on("mouseUp",this.onMouseUp.bind(this))},t.prototype.updateBoardPosition=function(){var t=this.container.getBoundingClientRect();this.boardX=t.x,this.boardY=t.y},t.prototype.exportSvg=function(){return""},t.prototype.setSelected=function(t){console.log(t),this.selection=t;var e="elementSelected";t&&0!=t.length?(this.updateSelectionArea(),this._cachedEvent.customData={elements:t,area:this.selectionArea}):e="nothingSelected",this._eventEmitter.trigger(e,[this._cachedEvent])},t.prototype.setMode=function(t){this.currentMode=t,this._cachedEvent.customData={mode:t},this._eventEmitter.trigger("changeMode",[this._cachedEvent])},t.prototype.updateSelectionArea=function(){var t=this.selection;1==t.length?(this.selectionArea.transform=t[0].transform.clone(),this.selectionArea.box=new c(0,0,1,1)):(this.selectionArea.transform.reset(),this.selectionArea.box=c.mergeAll(t.map((function(t){return t.AABB}))))},t.prototype.handleMouseDown=function(t){this.mouseStartX=t.clientX-this.boardX,this.mouseStartY=t.clientY-this.boardY,this._cachedEvent.mouseEvent=t,this._cachedEvent.customData||(this._cachedEvent.customData={}),this._cachedEvent.customData.x=this.mouseStartX,this._cachedEvent.customData.y=this.mouseStartY,this._eventEmitter.trigger("mouseDown",[this._cachedEvent])},t.prototype.handleMouseMove=function(t){var e=[t.clientX-this.boardX,t.clientY-this.boardY],n=e[0],o=e[1];this._cachedEvent.mouseEvent=t,this._cachedEvent.customData||(this._cachedEvent.customData={}),this._cachedEvent.customData.x=n,this._cachedEvent.customData.y=o,this._eventEmitter.trigger("mouseMove",[this._cachedEvent])},t.prototype.handleMouseUp=function(t){this._cachedEvent.mouseEvent=t,this._cachedEvent.customData.x=t.clientX-this.boardX,this._cachedEvent.customData.y=t.clientY-this.boardY,this._eventEmitter.trigger("mouseUp",[this._cachedEvent])},t.prototype.handleClick=function(t){},t.prototype.handleDBClick=function(t){},t.prototype.handleKeyDown=function(t){switch(t.key){case"r":this.setMode(e.CREATE),this.currentCreateMode=o.RECT;break;case"o":this.setMode(e.CREATE),this.currentCreateMode=o.ELLIPSE;break;case"l":this.setMode(e.CREATE),this.currentCreateMode=o.LINE;break;case"v":this.setMode(e.SELECT),this.currentCreateMode=o.LINE}},t.prototype.onMouseDown=function(t){if(console.log("function onMouseDown..."),this.MouseDown=!0,this.currentMode===e.CREATE)return this._cachedEvent.name="createElement",this._cachedEvent.customData={type:this.currentCreateMode,startX:this.mouseStartX,startY:this.mouseStartY},void this._eventEmitter.trigger("createElement",[this._cachedEvent]);console.log("not create mode..."),this.mouseStatusManager.mouseStatus!=i.ROTATE?(console.log("not rotate mode..."),this.mouseStatusManager.mouseStatus!=i.SCALE?(console.log("not scale mode..."),this.selection&&this.selection.length>=1&&this.clickOnSelectedArea(t)||this.clickOnElement(new a(this.mouseStartX,this.mouseStartY))?this.setMode(e.DRAG):(this.setMode(e.SELECT),this._cachedEvent.name="selectStart",this._eventEmitter.trigger("selectStart",[this._cachedEvent]))):this.setMode(e.SCALE)):this.setMode(e.ROTATE)},t.prototype.onMouseMove=function(t){this.currentMode===e.CREATE&&this.MouseDown?(this._cachedEvent.customData={startX:this.mouseStartX,startY:this.mouseStartY,endX:t.customData.x,endY:t.customData.y},this._eventEmitter.trigger("creating",[this._cachedEvent])):this.currentMode==e.DRAG?(this._cachedEvent.customData={startX:this.mouseStartX,startY:this.mouseStartY,endX:t.customData.x,endY:t.customData.y},this._eventEmitter.trigger("draging",[this._cachedEvent])):this.currentMode==e.ROTATE?(this._cachedEvent.customData={startX:this.mouseStartX,startY:this.mouseStartY,endX:t.customData.x,endY:t.customData.y},this._eventEmitter.trigger("rotating",[this._cachedEvent])):this.currentMode==e.SCALE?(this._cachedEvent.customData={startX:this.mouseStartX,startY:this.mouseStartY,endX:t.customData.x,endY:t.customData.y},this._eventEmitter.trigger("scaling",[this._cachedEvent])):this.MouseDown&&(this._cachedEvent.customData={startX:this.mouseStartX,startY:this.mouseStartY,endX:t.customData.x,endY:t.customData.y},this._eventEmitter.trigger("selectMove",[this._cachedEvent]))},t.prototype.onMouseUp=function(t){this.MouseDown=!1,this.currentMode===e.CREATE?this._eventEmitter.trigger("createEnd",[this._cachedEvent]):this.currentMode==e.SELECT?this._eventEmitter.trigger("selectEnd",[this._cachedEvent]):this.currentMode==e.ROTATE?this._eventEmitter.trigger("rotateEnd",[this._cachedEvent]):this.currentMode==e.DRAG?this._eventEmitter.trigger("dragEnd",[this._cachedEvent]):this.currentMode==e.SCALE&&this._eventEmitter.trigger("scaleEnd",[this._cachedEvent]),this.currentMode=e.SELECT},t.prototype.onSelectStart=function(t){},t.prototype.onSelectMove=function(t){},t.prototype.onSelectEnd=function(t){},t.prototype.onCreateElement=function(t){t.mouseEvent;var e=t.customData;switch(console.log(e.type),e.type){case o.RECT:var n=new S(e.startX,e.startY,0,0);this.svgcontent.append(n.domInstance),this.elements.push(n),this.setSelected([n]);break;case o.ELLIPSE:var r=new b(e.startX,e.startY,0,0);this.svgcontent.append(r.domInstance),this.elements.push(r),this.setSelected([r]);break;default:h.Error("error insert mode")}},t.prototype.onCreateMove=function(t){this.updateSelectionArea(),console.log(this.selection),this.container.className&&(this.container.className=""),console.log("handle create move..."),t.mouseEvent;var e=t.customData,n=[Math.abs(e.endX-e.startX),Math.abs(e.endY-e.startY)],o=n[0],r=n[1];console.log(o,r),this.selection[0].transform.a=o,this.selection[0].transform.d=r,this.selection[0].transform.e=Math.min(e.endX,e.startX),this.selection[0].transform.f=Math.min(e.endY,e.startY),this.selection[0].updateRendering()},t.prototype.onCreateEnd=function(t){console.log("create element end...")},t.prototype.onDragStart=function(t){},t.prototype.onDraging=function(t){var e=this,n=(t.mouseEvent,t.customData),o=n.startX,r=n.startY,i=n.endX,s=n.endY;this.selection.forEach((function(t,n){t.transform.e=e.selectionTransforms[n].e+i-o,t.transform.f=e.selectionTransforms[n].f+s-r,t.updateRendering()})),this.updateSelectionArea()},t.prototype.onDragEnd=function(t){},t.prototype.onRotateStart=function(t){},t.prototype.onRotating=function(t){var e=this,n=(t.mouseEvent,t.customData),o=n.startX,r=n.startY,i=n.endX,s=n.endY,c=this.selectionArea.center(),h=new a(o-c.x,r-c.y),u=new a(i-c.x,s-c.y),p=h.angle(u),l=h.crossMultiply(u);p=l>0?p:2*Math.PI-p,console.log(p/Math.PI*180),this.selection.forEach((function(t,n){t.transform.copy(e.selectionTransforms[n].clone().rotate(p,c)),t.updateRendering()}))},t.prototype.onRotateEnd=function(t){this.updateSelectionArea()},t.prototype.onScaleStart=function(t){this.lastFrameWidth=this.selection[0].frameWidth,this.lastFrameHeight=this.selection[0].frameHeight;var e=1,n=1;switch(this.mouseStatusManager.cornerType){default:case s.RB:break;case s.RT:n=-1;break;case s.LB:e=-1;break;case s.LT:e=n=-1}this.fx=e,this.fy=n},t.prototype.onScaling=function(t){var e=this,n=(t.mouseEvent,t.customData),o=n.startX,r=n.startY,i=n.endX,s=n.endY,c=new a(o,r),h=new a(i,s),u=this.fx,p=this.fy;this.selection.forEach((function(t,n){var o=c.clone().applyTransform(e.selectionTransforms[n].inverse()),r=h.clone().applyTransform(e.selectionTransforms[n].inverse());r.subtract(o);var i=[u*r.x+1,p*r.y+1],s=i[0],l=i[1],f=[Math.max(Math.abs(s),.001),Math.max(Math.abs(l),.001)],d=f[0],m=f[1];s=s<0?-d:d,l=l<0?-m:m,t.transform.copy(e.selectionTransforms[n].clone().scale(s,l,new a(-1==u?1:0,-1==p?1:0))),t.updateRendering()}))},t.prototype.onScaleEnd=function(t){this.updateSelectionArea()},t.prototype.onChangeMode=function(t){var n=t.customData;console.log("change mode:",n.mode),n.mode===e.SELECT?this.setSelected([]):this.currentMode===e.CREATE?this.container.className="cursor-crosshair":this.currentMode==e.DRAG?(this.selectionTransforms=this.selection.map((function(t){return t.transform.clone()})),this._cachedEvent.customData={transforms:this.selectionTransforms},this._eventEmitter.trigger("dragStart",[this._cachedEvent])):this.currentMode==e.ROTATE?(this.selectionTransforms=this.selection.map((function(t){return t.transform.clone()})),this._cachedEvent.customData={transforms:this.selectionTransforms},this._eventEmitter.trigger("rotateStart",[this._cachedEvent])):this.currentMode==e.SCALE&&(this.selectionTransforms=this.selection.map((function(t){return t.transform.clone()})),this._cachedEvent.customData={transforms:this.selectionTransforms},this._eventEmitter.trigger("scaleStart",[this._cachedEvent]))},t.prototype.onMouseStatusChange=function(t){},t.prototype.clickOnSelectedArea=function(t){return this.selectionArea.include(new a(t.customData.x,t.customData.y))},t.prototype.clickOnElement=function(t){var e=this.elements.sort((function(t,e){return t.zIndex>e.zIndex?1:-1})).find((function(e){return new p(new c(0,0,1,1),e.transform).include(t)}));return this.setSelected(e?[e]:[]),console.log("into function clickONElement"),e&&console.log("click on:",e.id),!!e},t.idPrefix="svg",t}();!function(t){t.SELECT="SELECT",t.DRAG="DRAG",t.ROTATE="ROTATE",t.SCALE="SCALE",t.CREATE="CREATE",t.DRAW="DRAW"}(e||(e={})),function(t){t.RECT="RECT",t.ELLIPSE="ELLIPsE",t.LINE="LINE"}(o||(o={})),function(t){t[t.CASUAL=0]="CASUAL",t[t.SCALE=1]="SCALE"}(r||(r={})),function(t){t.SELECT="SELECT",t.DRAG="DRAG",t.SCALE="SCALE",t.ROTATE="ROTATE"}(i||(i={})),function(t){t[t.LT=0]="LT",t[t.LM=1]="LM",t[t.LB=2]="LB",t[t.CT=3]="CT",t[t.CM=4]="CM",t[t.CB=5]="CB",t[t.RT=6]="RT",t[t.RM=7]="RM",t[t.RB=8]="RB"}(s||(s={}));var j=n(379),L=n.n(j),P=n(795),B=n.n(P),Y=n(569),k=n.n(Y),X=n(565),I=n.n(X),N=n(216),U=n.n(N),z=n(589),H=n.n(z),G=n(424),Z={};Z.styleTagTransform=H(),Z.setAttributes=I(),Z.insert=k().bind(null,"head"),Z.domAPI=B(),Z.insertStyleElement=U(),L()(G.Z,Z),G.Z&&G.Z.locals&&G.Z.locals,console.log("entry index.ts"),new O(document.body)})()})();
//# sourceMappingURL=index.js.map